<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>笑松小站</title>
  
  <subtitle>写我喜欢 读我所爱</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.seoui.com/"/>
  <updated>2019-08-23T07:31:21.272Z</updated>
  <id>http://blog.seoui.com/</id>
  
  <author>
    <name>peachyy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Neo4j入门教程</title>
    <link href="http://blog.seoui.com/2019/08/23/neo4j_study/"/>
    <id>http://blog.seoui.com/2019/08/23/neo4j_study/</id>
    <published>2019-08-22T16:00:00.000Z</published>
    <updated>2019-08-23T07:31:21.272Z</updated>
    
    <content type="html"><![CDATA[<h4 id="第一章：介绍"><a href="#第一章：介绍" class="headerlink" title="第一章：介绍"></a>第一章：介绍</h4><h5 id="Neo4j是什么"><a href="#Neo4j是什么" class="headerlink" title="Neo4j是什么"></a>Neo4j是什么</h5><p>Neo4j是一个高性能的,NOSQL图形数据库，它将结构化数据存储在网络上而不是表中。它是一个嵌入式的、基于磁盘的、具备完全的事务特性的Java持久化引擎，但是它将结构化数据存储在网络(从数学角度叫做图)上而不是表中。Neo4j也可以被看作是一个高性能的图引擎，该引擎具有成熟数据库的所有特性。程序员工作在一个面向对象的、灵活的网络结构下而不是严格、静态的表中——但是他们可以享受到具备完全的事务特性、企业级的数据库的所有好处。</p><h5 id="Neo4j的特点"><a href="#Neo4j的特点" class="headerlink" title="Neo4j的特点"></a>Neo4j的特点</h5><p>SQL就像简单的查询语言Neo4j CQL<br>它遵循属性图数据模型<br>它通过使用Apache Lucence支持索引<br>它支持UNIQUE约束<br>它它包含一个用于执行CQL命令的UI：Neo4j数据浏览器<br>它支持完整的ACID（原子性，一致性，隔离性和持久性）规则<br>它采用原生图形库与本地GPE（图形处理引擎）<br>它支持查询的数据导出到JSON和XLS格式<br>它提供了REST API，可以被任何编程语言（如Java，Spring，Scala等）访问<br>它提供了可以通过任何UI MVC框架（如Node JS）访问的Java脚本<br>它支持两种Java API：Cypher API和Native Java API来开发Java应用程序</p><h5 id="Neo4j的优点"><a href="#Neo4j的优点" class="headerlink" title="Neo4j的优点"></a>Neo4j的优点</h5><p>它很容易表示连接的数据<br>检索/遍历/导航更多的连接数据是非常容易和快速的<br>它非常容易地表示半结构化数据<br>Neo4j CQL查询语言命令是人性化的可读格式，非常容易学习<br>它使用简单而强大的数据模型<br>它不需要复杂的连接来检索连接的/相关的数据，因为它很容易检索它的相邻节点或关系细节没有连接或索引</p><h4 id="第二章：安装"><a href="#第二章：安装" class="headerlink" title="第二章：安装"></a>第二章：安装</h4><h5 id="1-环境"><a href="#1-环境" class="headerlink" title="1.环境"></a>1.环境</h5><p>Centos 7.4</p><p>neo4j-community-3.4.1.tar.gz</p><h5 id="2-下载"><a href="#2-下载" class="headerlink" title="2.下载"></a>2.下载</h5><p>下载地址 <a href="https://neo4j.com/download/other-releases/" target="_blank" rel="noopener">https://neo4j.com/download/other-releases/</a></p><p>下载</p><p>wget <a href="https://neo4j.com/artifact.php?name=neo4j-community-3.4.1-unix.tar.gz" target="_blank" rel="noopener">https://neo4j.com/artifact.php?name=neo4j-community-3.4.1-unix.tar.gz</a><br>解压</p><p>tar -zxvf neo4j-community-3.4.1.tar.gz</p><h5 id="3-开启远程访问"><a href="#3-开启远程访问" class="headerlink" title="3.开启远程访问"></a>3.开启远程访问</h5><p>一、对于3.0以前的版本</p><p>在安装目录的 $NEO4J_HOME/conf/neo4j.conf 文件内，找到下面一行，将注释#号去掉就可以了 #dbms.connector.https.address=localhost:7473 改为 dbms.connector.https.address=0.0.0.0:7473 这样，远程其他电脑可以用本机的IP或者域名后面跟上7474 端口就能打开web界面了 如： https://:7473</p><p>当然，你的操作系统的防火墙也要确保开放了7474端口才行，防火墙怎样开放请自行针对自己的操作系统查找文档</p><p>二、对于3.1及以后的版本</p><p>在安装目录的 $NEO4J_HOME/conf/neo4j.conf 文件内，找到下面一行，将注释#号去掉就可以了 dbms.connectors.default_listen_address=0.0.0.0</p><h5 id="4-测试"><a href="#4-测试" class="headerlink" title="4.测试"></a>4.测试</h5><p>在bin目录下，执行命令：./neo4j start启动，其他命令 { console | start | stop | restart | status } </p><p>访问<a href="http://IP地址:7474/" target="_blank" rel="noopener">http://IP地址:7474/</a>, 出现下图即代表安装成功，顶部的$输入框用来执行下面的CQL语句。</p><h4 id="第三章：CQL"><a href="#第三章：CQL" class="headerlink" title="第三章：CQL"></a>第三章：CQL</h4><h5 id="1-CQL简介"><a href="#1-CQL简介" class="headerlink" title="1.CQL简介"></a>1.CQL简介</h5><p>CQL代表Cypher查询语言。 像Oracle数据库具有查询语言SQL，Neo4j具有CQL作为查询语言。</p><h6 id="Neo4j-CQL"><a href="#Neo4j-CQL" class="headerlink" title="Neo4j CQL -"></a>Neo4j CQL -</h6><ul><li>它是Neo4j图形数据库的查询语言。</li><li>它是一种声明性模式匹配语言</li><li>它遵循SQL语法。</li><li><p>它的语法是非常简单且人性化、可读的格式。</p><h6 id="如Oracle-SQL"><a href="#如Oracle-SQL" class="headerlink" title="如Oracle SQL -"></a>如Oracle SQL -</h6></li><li><p>Neo4j CQL 命令来执行数据库操作。</p></li><li>Neo4j CQL 支持多个子句像在哪里，顺序等，以非常简单的方式编写非常复杂的查询。</li><li><p>NNeo4j CQL 支持一些功能，如字符串，Aggregation.In 加入他们，它还支持一些关系功能。</p><h5 id="2-Neo4j-CQL命令-条款"><a href="#2-Neo4j-CQL命令-条款" class="headerlink" title="2.Neo4j CQL命令/条款"></a>2.Neo4j CQL命令/条款</h5><p>常用的Neo4j CQL命令/条款如下：</p></li><li><p>CREATE     创建节点，关系和属性</p></li><li>MATCH      检索有关节点，关系和属性数据</li><li>RETURN     返回查询结果</li><li>WHERE       提供条件过滤检索数据</li><li>DELETE      删除节点和关系</li><li>REMOVE     删除节点和关系的属性</li><li>ORDER BY   ORDER BY以…排序 排序检索数据</li><li>SET         添加或更新标签</li></ul><h5 id="3-Neo4j-CQL-函数"><a href="#3-Neo4j-CQL-函数" class="headerlink" title="3.Neo4j CQL 函数"></a>3.Neo4j CQL 函数</h5><p>以下是常用的Neo4j CQL函数：</p><ul><li><p>String 字符串 它们用于使用String字面量。</p></li><li><p>Aggregation 聚合 它们用于对CQL查询结果执行一些聚合操作。</p></li><li><p>Relationship 关系 他们用于获取关系的细节，如startnode，endnode等。</p></li></ul><p>我们将在后面的章节中详细讨论所有Neo4j CQL命令，子句和函数语法，用法和示例。</p><h5 id="4-Neo4j-CQL数据类型"><a href="#4-Neo4j-CQL数据类型" class="headerlink" title="4.Neo4j CQL数据类型"></a>4.Neo4j CQL数据类型</h5><p>这些数据类型与Java语言类似。 它们用于定义节点或关系的属性</p><p>Neo4j CQL支持以下数据类型：</p><table><thead><tr><th>No.</th><th style="text-align:center">CQL数据类型</th><th style="text-align:right">用法</th></tr></thead><tbody><tr><td>1.</td><td style="text-align:center">boolean</td><td style="text-align:right">用于表示布尔文字：true，false。</td></tr><tr><td>2.</td><td style="text-align:center">byte</td><td style="text-align:right">用于表示8位整数。</td></tr><tr><td>3.</td><td style="text-align:center">short</td><td style="text-align:right">用于表示16位整数。</td></tr><tr><td>4.</td><td style="text-align:center">int</td><td style="text-align:right">用于表示32位整数。</td></tr><tr><td>5.</td><td style="text-align:center">long</td><td style="text-align:right">用于表示64位整数。</td></tr><tr><td>6.</td><td style="text-align:center">float</td><td style="text-align:right">用于表示32位浮点数。</td></tr><tr><td>7.</td><td style="text-align:center">double</td><td style="text-align:right">用于表示64位浮点数。</td></tr><tr><td>8.</td><td style="text-align:center">char</td><td style="text-align:right">用于表示16位字符。</td></tr><tr><td>9.</td><td style="text-align:center">String</td><td style="text-align:right">用于表示字符串。</td></tr></tbody></table><h4 id="第四章：命令"><a href="#第四章：命令" class="headerlink" title="第四章：命令"></a>第四章：命令</h4><h5 id="1-CREATE创建"><a href="#1-CREATE创建" class="headerlink" title="1.CREATE创建"></a>1.CREATE创建</h5><p>Neo4j CQL创建一个没有属性的节点</p><p>CREATE (<node-name>:<label-name>)<br>语法说明</label-name></node-name></p><p>规范说法是节点标签名称，其实相当于Mysql数据库中的表名，而是节点名称，其实代指创建的此行数据。</p><p>示例</p><p>CREATE (emp:Employee)<br>或者</p><p>CREATE (:Employee)<br>Neo4j CQL创建具有属性的节点</p><p>Neo4j CQL“CREATE”命令用于创建带有属性的节点。 它创建一个具有一些属性（键值对）的节点来存储数据。</p><pre><code class="shell">CREATE (   &lt;node-name&gt;:&lt;label-name&gt;   {          &lt;key&gt;:&lt;Value&gt;      ........      &lt;n-key&gt;:&lt;n-Value&gt;   })</code></pre><p>示例</p><p>CREATE (dept:Dept { deptno:10,dname:”Accounting”,location:”Hyderabad” })<br>创建多个标签到节点</p><p>语法：</p><p>CREATE (<node-name>:<label-name1>:<label-name2>…..:<label-namen>)<br>示例</label-namen></label-name2></label-name1></node-name></p><p>CREATE (m:Movie:Cinema:Film:Picture)</p><h5 id="2-MATCH查询"><a href="#2-MATCH查询" class="headerlink" title="2.MATCH查询"></a>2.MATCH查询</h5><p>Neo4j CQL MATCH命令用于</p><p>从数据库获取有关节点和属性的数据<br>从数据库获取有关节点，关系和属性的数据<br>MATCH命令语法：</p><pre><code class="shell">MATCH (   &lt;node-name&gt;:&lt;label-name&gt;)</code></pre><p>示例</p><p>MATCH (dept:Dept)<br>但是执行后会报错：</p><p>Neo.ClientError.Statement.SyntaxError:<br>Query cannot conclude with MATCH<br>(must be RETURN or an update clause) (line 1, column 1 (offset: 0))<br>如果你观察到错误消息，它告诉我们，我们可以使用MATCH命令与RETURN子句或UPDATA子句。</p><h5 id="3-RETURN返回"><a href="#3-RETURN返回" class="headerlink" title="3.RETURN返回"></a>3.RETURN返回</h5><p>Neo4j CQL RETURN子句用于 -</p><p>检索节点的某些属性<br>检索节点的所有属性<br>检索节点和关联关系的某些属性<br>检索节点和关联关系的所有属性<br>RETURN命令语法：</p><pre><code class="shell">RETURN    &lt;node-name&gt;.&lt;property1-name&gt;,   ........   &lt;node-name&gt;.&lt;propertyn-name&gt;</code></pre><p>示例</p><p>MATCH (e:Employee) RETURN e<br>或</p><p>MATCH (dept: Dept)<br>RETURN dept.deptno,dept.dname,dept.location</p><h5 id="4-关系基础"><a href="#4-关系基础" class="headerlink" title="4.关系基础"></a>4.关系基础</h5><p>Neo4j图数据库遵循属性图模型来存储和管理其数据。</p><p>根据属性图模型，关系应该是定向的。 否则，Neo4j将抛出一个错误消息。</p><p>基于方向性，Neo4j关系被分为两种主要类型。</p><p>单向关系<br>双向关系<br>使用新节点创建关系</p><p>示例</p><p>CREATE (e:Employee)-[r:DemoRelation]-&gt;(c:Employee)<br>这句会创建节点e，节点c，以及e -&gt; c的关系r，这里需要注意方向，比如双向是</p><p>CREATE (e:Employee)&lt;-[r:DemoRelation]-&gt;(c:Employee)<br>使用已知节点创建带属性的关系：</p><pre><code class="shell">MATCH (&lt;node1-label-name&gt;:&lt;node1-name&gt;),(&lt;node2-label-name&gt;:&lt;node2-name&gt;)CREATE      (&lt;node1-label-name&gt;)-[&lt;relationship-label-name&gt;:&lt;relationship-name&gt;    {&lt;define-properties-list&gt;}]-&gt;(&lt;node2-label-name&gt;)RETURN &lt;relationship-label-name&gt;</code></pre><p> 还是一系列键值对</p><p>示例</p><pre><code class="shell">MATCH (cust:Customer),(cc:CreditCard) CREATE (cust)-[r:DO_SHOPPING_WITH{shopdate:"12/12/2014",price:55000}]-&gt;(cc) RETURN r</code></pre><p>检索关系节点的详细信息：</p><pre><code class="shell">MATCH (&lt;node1-label-name&gt;)-[&lt;relationship-label-name&gt;:&lt;relationship-name&gt;]-&gt;(&lt;node2-label-name&gt;)RETURN &lt;relationship-label-name&gt;</code></pre><p>示例</p><pre><code class="shell">MATCH (cust)-[r:DO_SHOPPING_WITH]-&gt;(cc) RETURN cust,cc</code></pre><h5 id="5-WHERE子句"><a href="#5-WHERE子句" class="headerlink" title="5.WHERE子句"></a>5.WHERE子句</h5><p>像SQL一样，Neo4j CQL在CQL MATCH命令中提供了WHERE子句来过滤MATCH查询的结果。</p><p>简单WHERE子句语法</p><p>WHERE <property-name> <comparison-operator> <value><br>语法说明：</value></comparison-operator></property-name></p><table><thead><tr><th>No.</th><th style="text-align:center">语法元素</th><th style="text-align:right">描述</th></tr></thead><tbody><tr><td>1</td><td style="text-align:center">WHERE</td><td style="text-align:right">它是一个Neo4j CQL关键字。</td></tr><tr><td>2</td><td style="text-align:center">&lt;属性名称&gt;</td><td style="text-align:right">它是节点或关系的属性名称。</td></tr><tr><td>3</td><td style="text-align:center">&lt;比较运算符&gt;</td><td style="text-align:right">它是Neo4j CQL比较运算符之一。</td></tr><tr><td>4</td><td style="text-align:center">&lt;值&gt;</td><td style="text-align:right">它是一个字面值，如数字文字，字符串文字等。</td></tr></tbody></table><h6 id="Neo4j-CQL中的比较运算符"><a href="#Neo4j-CQL中的比较运算符" class="headerlink" title="Neo4j CQL中的比较运算符"></a>Neo4j CQL中的比较运算符</h6><p>Neo4j 支持以下的比较运算符，在 Neo4j CQL WHERE 子句中使用来支持条件</p><table><thead><tr><th>No.</th><th style="text-align:center">比较运算符</th><th style="text-align:right">描述</th></tr></thead><tbody><tr><td>1.</td><td style="text-align:center">=</td><td style="text-align:right">它是Neo4j CQL“等于”运算符。</td></tr><tr><td>2.</td><td style="text-align:center">&lt;&gt;</td><td style="text-align:right">它是一个Neo4j CQL“不等于”运算符。</td></tr><tr><td>3.</td><td style="text-align:center">&lt;</td><td style="text-align:right">它是一个Neo4j CQL“小于”运算符。</td></tr><tr><td>4.</td><td style="text-align:center">&gt;</td><td style="text-align:right">它是一个Neo4j CQL“大于”运算符。</td></tr><tr><td>5.</td><td style="text-align:center">&lt;=</td><td style="text-align:right">它是一个Neo4j CQL“小于或等于”运算符。</td></tr><tr><td>6.</td><td style="text-align:center">=</td><td style="text-align:right">它是一个Neo4j CQL“大于或等于”运算符。</td></tr></tbody></table><p>我们可以使用布尔运算符在同一命令上放置多个条件。</p><h6 id="Neo4j-CQL中的布尔运算符"><a href="#Neo4j-CQL中的布尔运算符" class="headerlink" title="Neo4j CQL中的布尔运算符"></a>Neo4j CQL中的布尔运算符</h6><p>Neo4j支持以下布尔运算符在Neo4j CQL WHERE子句中使用以支持多个条件。</p><table><thead><tr><th>No.</th><th style="text-align:center">布尔运算符</th><th style="text-align:right">描述</th></tr></thead><tbody><tr><td>1</td><td style="text-align:center">AND</td><td style="text-align:right">它是一个支持AND操作的Neo4j CQL关键字。</td></tr><tr><td>2</td><td style="text-align:center">OR</td><td style="text-align:right">它是一个Neo4j CQL关键字来支持OR操作。</td></tr><tr><td>3</td><td style="text-align:center">NOT</td><td style="text-align:right">它是一个Neo4j CQL关键字支持NOT操作。</td></tr><tr><td>4</td><td style="text-align:center">XOR</td><td style="text-align:right">它是一个支持XOR操作的Neo4j CQL关键字。</td></tr></tbody></table><p>示例</p><p>MATCH (emp:Employee)<br>WHERE emp.name = ‘Abc’ OR emp.name = ‘Xyz’<br>RETURN emp</p><p>利用WHERE创建指定关系节点：</p><p>MATCH (cust:Customer),(cc:CreditCard)<br>WHERE cust.id = “1001” AND cc.id= “5001”<br>CREATE (cust)-[r:DO_SHOPPING_WITH{shopdate:”12/12/2014”,price:55000}]-&gt;(cc)<br>RETURN r<br>有必要补充一下，可以不使用WHERE达到WHERE的一些效果，比如</p><p>MATCH p=(m:Bot{id:123})&lt;-[:BotRelation]-&gt;(:Bot)  RETURN p</p><h5 id="6-DELETE删除"><a href="#6-DELETE删除" class="headerlink" title="6.DELETE删除"></a>6.DELETE删除</h5><p>Neo4j使用CQL DELETE子句</p><p>删除节点。<br>删除节点及相关节点和关系。<br>DELETE节点子句语法</p><p>DELETE <node-name-list><br>示例</node-name-list></p><p>MATCH (e: Employee) DELETE e<br>DELETE节点和关系子句语法</p><p>DELETE <node1-name>,<node2-name>,<relationship-name><br>示例</relationship-name></node2-name></node1-name></p><p>MATCH (cc: CreditCard)-[rel]-(c:Customer)<br>DELETE cc,c,rel</p><h5 id="7-REMOVE删除"><a href="#7-REMOVE删除" class="headerlink" title="7.REMOVE删除"></a>7.REMOVE删除</h5><p>有时基于我们的客户端要求，我们需要向现有节点或关系添加或删除属性。</p><p>我们使用Neo4j CQL SET子句向现有节点或关系添加新属性。</p><p>我们使用Neo4j CQL REMOVE子句来删除节点或关系的现有属性。</p><p>Neo4j CQL REMOVE命令用于</p><p>删除节点或关系的标签<br>删除节点或关系的属性<br>Neo4j CQL DELETE和REMOVE命令之间的主要区别 -</p><p>DELETE操作用于删除节点和关联关系。<br>REMOVE操作用于删除标签和属性。<br>Neo4j CQL DELETE和REMOVE命令之间的相似性 -</p><p>这两个命令不应单独使用。<br>两个命令都应该与MATCH命令一起使用。</p><h6 id="1-REMOVE属性子句语法"><a href="#1-REMOVE属性子句语法" class="headerlink" title="1.REMOVE属性子句语法"></a>1.REMOVE属性子句语法</h6><p>REMOVE <code>&lt;node-name&gt;.&lt;property1-name&gt;,&lt;node-name&gt;.&lt;property2-name&gt;</code></p><p>语法说明：</p><ul><li>node-name 它是节点的名称。</li><li>property1-name 它是节点的属性名称。</li></ul><p>示例</p><p>MATCH (dc:DebitCard)<br>REMOVE dc.cvv<br>RETURN dc</p><h6 id="2-REMOVE一个Label子句语法："><a href="#2-REMOVE一个Label子句语法：" class="headerlink" title="2.REMOVE一个Label子句语法："></a>2.REMOVE一个Label子句语法：</h6><p>REMOVE <code>&lt;label-name-list&gt;</code></p><p>2.它是一个标签列表，用于永久性地从节点或关系中删除它。<br>语法</p><p><code>&lt; node-name &gt;:&lt; label2-name &gt;, .... &lt; node-name &gt;:&lt; labeln-name &gt;</code> </p><p>示例</p><p>1.我们创建一个含有两个标签的节点：</p><p>CREATE (m:Movie:Pic)<br>2.查询该节点</p><p>MATCH (n:Movie) RETURN n</p><p>3.删除标签</p><p>MATCH (m:Movie)<br>REMOVE m:Pic<br>4.再次查询 </p><h5 id="8-SET子句"><a href="#8-SET子句" class="headerlink" title="8.SET子句"></a>8.SET子句</h5><p>有时，根据我们的客户端要求，我们需要向现有节点或关系添加新属性。</p><p>要做到这一点，Neo4j CQL提供了一个SET子句。</p><p>Neo4j CQL已提供SET子句来执行以下操作。</p><p>向现有节点或关系添加新属性<br>添加或更新属性值<br>SET子句语法</p><p>SET <code>&lt;node-label-name&gt;.&lt;property1-name&gt;,...&lt;node-laben-name&gt;.&lt;propertyn-name&gt;</code><br>语法说明：</p><ul><li>node-label-name <code>&lt;节点标签名称&gt;</code>这是一个节点的标签名称。</li><li>property1-name <code>&lt;属性名称&gt;</code> 它是一个节点的属性名。</li></ul><p>示例</p><p>MATCH (dc:DebitCard)<br>SET dc.atm_pin = 3456<br>RETURN dc</p><h5 id="9-ORDER-BY排序"><a href="#9-ORDER-BY排序" class="headerlink" title="9.ORDER BY排序"></a>9.ORDER BY排序</h5><p>Neo4j CQL ORDER BY子句</p><p>Neo4j CQL在MATCH命令中提供了“ORDER BY”子句，对MATCH查询返回的结果进行排序。</p><p>我们可以按升序或降序对行进行排序。</p><p>默认情况下，它按升序对行进行排序。 如果我们要按降序对它们进行排序，我们需要使用DESC子句。</p><p>ORDER BY子句语法</p><p>ORDER BY <code>&lt;property-name-list&gt;  [DESC]</code><br>语法：</p><p><code>&lt;node-label-name&gt;.&lt;property1-name&gt;,</code><br><code>&lt;node-label-name&gt;.&lt;property2-name&gt;,</code><br><code>....</code><br><code>&lt;node-label-name&gt;.&lt;propertyn-name&gt;</code></p><ul><li>node-label-name 它是节点的标签名称。</li><li>property1-name  它是节点的属性名称。</li></ul><p>示例</p><p>MATCH (emp:Employee)<br>RETURN emp.empid,emp.name,emp.salary,emp.deptno<br>ORDER BY emp.name<br>10.UNION子句<br>与SQL一样，Neo4j CQL有两个子句，将两个不同的结果合并成一组结果</p><p>UNION<br>UNION ALL<br>UNION子句</p><p>它将两组结果中的公共行组合并返回到一组结果中。 它不从两个节点返回重复的行。</p><p>限制：</p><p>结果列类型和来自两组结果的名称必须匹配，这意味着列名称应该相同，列的数据类型应该相同。</p><h5 id="10-UNION子句语法"><a href="#10-UNION子句语法" class="headerlink" title="10 UNION子句语法"></a>10 UNION子句语法</h5><p><code>&lt;MATCH Command1&gt;</code><br> <code>UNION</code><br><code>&lt;MATCH Command2&gt;</code></p><p>注意 -</p><p>如果这两个查询不返回相同的列名和数据类型，那么它抛出一个错误。</p><p>示例</p><p>MATCH (cc:CreditCard) RETURN cc.id,cc.number<br>UNION<br>MATCH (dc:DebitCard) RETURN dc.id,dc.number<br>UNION ALL子句</p><p>它结合并返回两个结果集的所有行成一个单一的结果集。它还返回由两个节点重复行。</p><p>限制</p><p>结果列类型，并从两个结果集的名字必须匹配，这意味着列名称应该是相同的，列的数据类型应该是相同的。</p><h6 id="UNION-ALL子句语法"><a href="#UNION-ALL子句语法" class="headerlink" title="UNION ALL子句语法"></a>UNION ALL子句语法</h6><p><code>&lt;MATCH Command1&gt;</code><br><code>UNION ALL</code><br><code>&lt;MATCH Command2&gt;</code><br>示例</p><p>MATCH (cc:CreditCard) RETURN cc.id,cc.number<br>UNION ALL<br>MATCH (dc:DebitCard) RETURN dc.id,dc.number</p><h5 id="11-LIMIT和SKIP子句"><a href="#11-LIMIT和SKIP子句" class="headerlink" title="11.LIMIT和SKIP子句"></a>11.LIMIT和SKIP子句</h5><p>Neo4j CQL已提供LIMIT子句和SKIP来过滤或限制查询返回的行数。</p><p>简单来说：LIMIT返回前几行，SKIP返回后几行。</p><p>LIMIT 示例</p><p>MATCH (emp:Employee)<br>RETURN emp<br>LIMIT 2<br>它只返回Top的两个结果，因为我们定义了limit = 2。这意味着前两行。</p><p>SKIP示例</p><p>MATCH (emp:Employee)<br>RETURN emp<br>SKIP 2<br>它只返回来自Bottom的两个结果，因为我们定义了skip = 2。这意味着最后两行。</p><h5 id="12-MERGE命令"><a href="#12-MERGE命令" class="headerlink" title="12.MERGE命令"></a>12.MERGE命令</h5><p>Neo4j使用CQL MERGE命令 -</p><p>创建节点，关系和属性<br>为从数据库检索数据<br>MERGE命令是CREATE命令和MATCH命令的组合。</p><p>MERGE = CREATE + MATCH<br>Neo4j CQL MERGE命令在图中搜索给定模式，如果存在，则返回结果</p><p>如果它不存在于图中，则它创建新的节点/关系并返回结果。</p><p>Neo4j CQL MERGE语法</p><p>MERGE <code>(&lt;node-name&gt;:&lt;label-name&gt;</code><br>{<br>   <code>&lt;key&gt;:&lt;1-Value&gt;</code><br>   …..<br>   <code>&lt;n-key&gt;:&lt;n-Value&gt;</code><br>})<br>注意 -</p><p>Neo4j CQL MERGE命令语法与CQL CREATE命令类似。</p><p>我们将使用这两个命令执行以下操作 -</p><p>创建具有一个属性的配置文件节点：Id，名称<br>创建具有相同属性的同一个Profile节点：Id，Name<br>检索所有Profile节点详细信息并观察结果<br>我们将使用CREATE命令执行这些操作：</p><p>MERGE (gp2:GoogleProfile2{ Id: 201402,Name:”Nokia”})<br>MERGE (gp2:GoogleProfile2{ Id: 201402,Name:”Nokia”})<br>MATCH  (gp1:GoogleProfile1)<br>RETURN gp1.Id,gp1.Name<br>如果我们观察上面的查询结果，它只显示一行，因为CQL MERGE命令检查该节点在数据库中是否可用。 如果它不存在，它创建新节点。 否则，它不创建新的。</p><p>通过观察这些结果，我们可以说，CQL MERGE命令将新的节点添加到数据库，只有当它不存在。</p><h5 id="13-NULL值"><a href="#13-NULL值" class="headerlink" title="13.NULL值"></a>13.NULL值</h5><p>Neo4j CQL将空值视为对节点或关系的属性的缺失值或未定义值。</p><p>当我们创建一个具有现有节点标签名称但未指定其属性值的节点时，它将创建一个具有NULL属性值的新节点。</p><p>让我们用一个例子来看这个。</p><p>MATCH (e:Employee)<br>WHERE e.id IS NOT NULL<br>RETURN e.id,e.name,e.sal,e.deptno<br>提供了一个WHERE子句来过滤该行，即Id属性不应该包含NULL值。</p><p>MATCH (e:Employee)<br>WHERE e.id IS NULL<br>RETURN e.id,e.name,e.sal,e.deptno<br>这里我们使用IS操作符来仅返回NULL行。</p><h5 id="14-IN操作符"><a href="#14-IN操作符" class="headerlink" title="14.IN操作符"></a>14.IN操作符</h5><p>与SQL一样，Neo4j CQL提供了一个IN运算符，以便为CQL命令提供值的集合。</p><p>IN操作符语法</p><p>IN[<code>&lt;Collection-of-values&gt;</code>]<br>它是由逗号运算符分隔的值的集合。</p><p>示例</p><p>MATCH (e:Employee)<br>WHERE e.id IN [123,124]<br>RETURN e.id,e.name,e.sal,e.deptno</p><h5 id="15-INDEX索引"><a href="#15-INDEX索引" class="headerlink" title="15.INDEX索引"></a>15.INDEX索引</h5><p>Neo4j SQL支持节点或关系属性上的索引，以提高应用程序的性能。</p><p>我们可以为具有相同标签名称的所有节点的属性创建索引。</p><p>我们可以在MATCH或WHERE或IN运算符上使用这些索引列来改进CQL Command的执行。</p><p>Neo4J索引操作</p><p>Create Index 创建索引<br>Drop Index 丢弃索引<br>我们将在本章中用示例来讨论这些操作。</p><p>创建索引的语法：</p><p>CREATE INDEX ON :<code>&lt;label_name&gt; (&lt;property_name&gt;</code>)<br>注意：-</p><p>冒号（:)运算符用于引用节点或关系标签名称。</p><p>上述语法描述它在节点或关系的的上创建一个新索引。</p><p>示例</p><p>CREATE INDEX ON :Customer (name)<br>删除索引的语法：</p><p>DROP INDEX ON :<code>&lt;label_name&gt; (&lt;property_name&gt;</code>)<br>示例</p><p>DROP INDEX ON :Customer (name)</p><h5 id="16-UNIQUE约束"><a href="#16-UNIQUE约束" class="headerlink" title="16.UNIQUE约束"></a>16.UNIQUE约束</h5><p>在Neo4j数据库中，CQL CREATE命令始终创建新的节点或关系，这意味着即使您使用相同的值，它也会插入一个新行。 根据我们对某些节点或关系的应用需求，我们必须避免这种重复。 然后我们不能直接得到这个。 我们应该使用一些数据库约束来创建节点或关系的一个或多个属性的规则。</p><p>像SQL一样，Neo4j数据库也支持对NODE或Relationship的属性的UNIQUE约束</p><p>UNIQUE约束的优点</p><p>避免重复记录。<br>强制执行数据完整性规则<br>创建唯一约束语法</p><p>CREATE CONSTRAINT ON (&lt;label_name&gt;)<br>ASSERT &lt;property_name&gt; IS UNIQUE<br>语法说明：</p><table><thead><tr><th>No.</th><th style="text-align:center">语法元素</th><th style="text-align:right">描述</th></tr></thead><tbody><tr><td>1。</td><td style="text-align:center">CREATE CONSTRAINT ON</td><td style="text-align:right">它是一个Neo4j CQL关键字。</td></tr><tr><td>2。</td><td style="text-align:center">label_name</td><td style="text-align:right">它是节点或关系的标签名称。</td></tr><tr><td>3。</td><td style="text-align:center">ASSERT</td><td style="text-align:right">它是一个Neo4j CQL关键字。</td></tr><tr><td>4。</td><td style="text-align:center">property_name</td><td style="text-align:right">它是节点或关系的属性名称。</td></tr><tr><td>5。</td><td style="text-align:center">IS UNIQUE</td><td style="text-align:right">它是一个Neo4j CQL关键字，通知Neo4j数据库服务器创建一个唯一约束。</td></tr></tbody></table><p>注意：-</p><p>上述语法描述了只需要 节点或关系就可以创造一个独特的约束。</p><p>示例</p><p>CREATE CONSTRAINT ON (cc:CreditCard)<br>ASSERT cc.number IS UNIQUE<br>注意</p><p>如果创建约束时节点属性有重复值，Neo4j DB服务器将会抛出一个错误，表示无法创建。</p><p>删除UNIQUE约束语法：</p><p>DROP CONSTRAINT ON (&lt;label_name&gt;)<br>ASSERT &lt;property_name&gt; IS UNIQUE<br>示例</p><p>DROP CONSTRAINT ON (cc:CreditCard)<br>ASSERT cc.number IS UNIQUE<br>17.DISTINCT独特<br>这个函数的用法就像SQL中的distinct关键字，返回的是所有不同值。</p><p>示例 </p><p>MATCH (n:Movie) RETURN Distinct(n.name)</p><h4 id="第五章：管理员-数据备份-恢复"><a href="#第五章：管理员-数据备份-恢复" class="headerlink" title="第五章：管理员 数据备份/恢复"></a>第五章：管理员 数据备份/恢复</h4><h5 id="1-数据库备份"><a href="#1-数据库备份" class="headerlink" title="1.数据库备份"></a>1.数据库备份</h5><p>在对Neo4j数据进行备份、还原、迁移的操作时，首先要关闭neo4j;</p><p>cd %NEO4J_HOME%/bin<br>./neo4j stop<br>数据备份到文件</p><p>./neo4j-admin  dump –database=graph.db –to=/home/2018.dump<br>之后，进行数据还原，将生成的存储文件拷贝到另一个相同版本的环境中。</p><h5 id="2-数据库恢复"><a href="#2-数据库恢复" class="headerlink" title="2.数据库恢复"></a>2.数据库恢复</h5><p>还原、迁移之前 ，关闭neo4j服务。操作同上；</p><p>数据导入：</p><p>./neo4j-admin load –from=/home/2016-10-02.dump –database=graph.db –force<br>重启服务：</p><p>./neo4j start</p><p>  参考 <code>https://cloud.tencent.com/developer/article/1336299</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;第一章：介绍&quot;&gt;&lt;a href=&quot;#第一章：介绍&quot; class=&quot;headerlink&quot; title=&quot;第一章：介绍&quot;&gt;&lt;/a&gt;第一章：介绍&lt;/h4&gt;&lt;h5 id=&quot;Neo4j是什么&quot;&gt;&lt;a href=&quot;#Neo4j是什么&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="技术" scheme="http://blog.seoui.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="neo4j" scheme="http://blog.seoui.com/tags/neo4j/"/>
    
  </entry>
  
  <entry>
    <title>thymeleaf自定义dialect</title>
    <link href="http://blog.seoui.com/2019/07/22/custom-thymeleaf-dealect/"/>
    <id>http://blog.seoui.com/2019/07/22/custom-thymeleaf-dealect/</id>
    <published>2019-07-21T16:00:00.000Z</published>
    <updated>2019-07-22T08:57:26.950Z</updated>
    
    <content type="html"><![CDATA[<p>有时候<code>thymeleaf</code>自带的模板方言有点不够用的时候 可以支持自定义，最近遇到一个在<code>thymeleaf</code>模板中显示订单状态的需求。<br>当然也可以使用 <code>switch case</code>的方式,但是如果很多的页面都要使用的时候你得一直复制代码 很麻烦 而且中途如果修改了某个状态码含义 你得全部修改一遍。这当然不是我们得正确使用姿势。状态码含义如下</p><p>9 待支付定金<br>10 待停车(已支付定金)<br>11 停车中<br>12 停车结束(待支付尾款)<br>13 订单完成(已支付尾款)</p><h4 id="定义处理tag得解析器"><a href="#定义处理tag得解析器" class="headerlink" title="定义处理tag得解析器"></a>定义处理tag得解析器</h4><p> 这里我们定义一个名为<code>orderstatus</code>的属性(attributeName),表示遇到这个属性会调用doProcess方法中的代码</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParkingOrderStatusTagProcessor</span>  <span class="keyword">extends</span> <span class="title">AbstractAttributeTagProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">ParkingOrderStatusTagProcessor</span><span class="params">(String dialectPrefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(TemplateMode.HTML, dialectPrefix,</span><br><span class="line"><span class="keyword">null</span>, <span class="keyword">false</span>, <span class="string">"orderstatus"</span>, <span class="keyword">true</span>, <span class="number">1000</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(ITemplateContext context, IProcessableElementTag tag,</span></span></span><br><span class="line"><span class="function"><span class="params">AttributeName attributeName, String attributeValue,</span></span></span><br><span class="line"><span class="function"><span class="params">IElementTagStructureHandler structureHandler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> IStandardExpressionParser expressionParser = StandardExpressions</span><br><span class="line">                .getExpressionParser(context.getConfiguration());</span><br><span class="line">        <span class="keyword">final</span> IStandardExpression expression = </span><br><span class="line">expressionParser.parseExpression(context, attributeValue);</span><br><span class="line">        Object val=expression.execute(context);</span><br><span class="line">        <span class="keyword">if</span>(val!=<span class="keyword">null</span> &amp;&amp; val <span class="keyword">instanceof</span> Number)&#123;</span><br><span class="line">            structureHandler.setBody(</span><br><span class="line">              HtmlEscape.escapeHtml5(getOrderStatus((Integer) val)), <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getOrderStatus</span><span class="params">(Integer status)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(status== <span class="number">9</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"待支付定金"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status==<span class="number">10</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"待停车(已支付定金)"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status==<span class="number">11</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"停车中"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status==<span class="number">12</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"停车结束(待支付尾款)"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status==<span class="number">13</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"订单完成(已支付尾款)"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"未知状态"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="定义方言"><a href="#定义方言" class="headerlink" title="定义方言"></a>定义方言</h4><p> 创建一个方言 因为<code>thymeleaf</code>模板引擎需要先添加方言(<code>Dealect</code>),而这个方言中又可以添加多个tag属性解析器,这里设置了一个名为<code>park</code>的前缀，并添加了上面的<code>ParkingOrderStatusTagProcessor</code>属性解析器。</p><p> 在模板中就可以使用<code>&lt;div park:orderstatus=&quot;${order.status}&quot;&gt;&lt;/div&gt;</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParkDealect</span> <span class="keyword">extends</span> <span class="title">AbstractProcessorDialect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ParkDealect</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(<span class="string">"parkingDealect"</span>, <span class="string">"park"</span>, <span class="number">1001</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;IProcessor&gt; <span class="title">getProcessors</span><span class="params">(String dialectPrefix)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> Set&lt;IProcessor&gt; processors = <span class="keyword">new</span> HashSet&lt;IProcessor&gt;();</span><br><span class="line">processors.add(<span class="keyword">new</span> ParkingOrderStatusTagProcessor(dialectPrefix));</span><br><span class="line"><span class="keyword">return</span> processors;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="添加方言到模板引擎中"><a href="#添加方言到模板引擎中" class="headerlink" title="添加方言到模板引擎中"></a>添加方言到模板引擎中</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpringTemplateEngine <span class="title">templateEngine</span><span class="params">(@Autowired ITemplateResolver resolver)</span></span>&#123;</span><br><span class="line">    SpringTemplateEngine templateEngine = <span class="keyword">new</span> SpringTemplateEngine();</span><br><span class="line">    templateEngine.setEnableSpringELCompiler(<span class="keyword">true</span>);</span><br><span class="line">    templateEngine.setTemplateResolver(resolver);</span><br><span class="line">    templateEngine.addDialect(<span class="keyword">new</span> ParkDealect());<span class="comment">//把定义好的方言添加进去</span></span><br><span class="line">    <span class="keyword">return</span> templateEngine;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 最后在模板中设置一下park的xmlns,我自己测试了一下 这个xmlns的文件不创建也没关系，但最好还是建好。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:park</span>=<span class="string">"http://www.peachyy.com/thymeleaf/park"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其实自定义方言就相当于JSP中的自定义标签。更多xmlns文件的细节后面在更新了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;有时候&lt;code&gt;thymeleaf&lt;/code&gt;自带的模板方言有点不够用的时候 可以支持自定义，最近遇到一个在&lt;code&gt;thymeleaf&lt;/code&gt;模板中显示订单状态的需求。&lt;br&gt;当然也可以使用 &lt;code&gt;switch case&lt;/code&gt;的方式,但是如果很多
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="技术" scheme="http://blog.seoui.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="thymeleaf" scheme="http://blog.seoui.com/tags/thymeleaf/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearch中短语匹配match_phrase</title>
    <link href="http://blog.seoui.com/2019/05/07/es-match-phrase/"/>
    <id>http://blog.seoui.com/2019/05/07/es-match-phrase/</id>
    <published>2019-05-06T16:00:00.000Z</published>
    <updated>2019-05-07T09:56:25.367Z</updated>
    
    <content type="html"><![CDATA[<p> 现有业务中很少用到<code>match_phrase</code>这个搜索，最近在实现基于<code>elasticsearch</code>的日志搜集 并自助告警一个业务，因为日志的不规范 所以需要用到对某个日志短语进行搜索，不能像match做全文检索。</p><p> 比如需要精确寻找日志中的<code>请求第三方CAKA服务器失败</code> </p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">GET /filebeat*/_search</span><br><span class="line">&#123;</span><br><span class="line">"query": &#123;</span><br><span class="line">        "match_phrase": &#123;</span><br><span class="line">            "message": "请求第三方CAKA服务器失败" </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询结果中就完全包含了这句短语。不会进行分词搜索。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt; 现有业务中很少用到&lt;code&gt;match_phrase&lt;/code&gt;这个搜索，最近在实现基于&lt;code&gt;elasticsearch&lt;/code&gt;的日志搜集 并自助告警一个业务，因为日志的不规范 所以需要用到对某个日志短语进行搜索，不能像match做全文检索。&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="技术" scheme="http://blog.seoui.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="elasticsearch" scheme="http://blog.seoui.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>认识go语言与环境搭建</title>
    <link href="http://blog.seoui.com/2019/03/26/go_install/"/>
    <id>http://blog.seoui.com/2019/03/26/go_install/</id>
    <published>2019-03-25T16:00:00.000Z</published>
    <updated>2019-03-26T04:00:23.714Z</updated>
    
    <content type="html"><![CDATA[<p> go编程语言是一个由Google开源的编程语言项目，它具有很强的表达能力、简洁高效，对并发特别友好，它是一个快速的、静态类型的编译型语言，感觉却像动态类型的解释型语言。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>安装一般可以选择源码安装、官方提供的可执行文件安装，一般在不修改源码的情况话 直接选择下载官方提供的可执行文件或者直接下载二进制压缩包安装即可。</p><h5 id="window"><a href="#window" class="headerlink" title="window"></a>window</h5><p>  如果是可执行文件安装方式 引导用户安装成功的 会自动配置好go的环境变量 在命令行输入<code>go</code> 就能看到go命令行的帮助提示。</p><p>  解压二进制文件安装方式 需要手动配置好go环境变量 运行go命令如下</p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">$ go</span><br><span class="line">Go is a<span class="built_in"> tool </span><span class="keyword">for</span> managing Go source code.</span><br><span class="line">Usage:</span><br><span class="line">        go &lt;command&gt; [arguments]</span><br><span class="line">The commands are:</span><br><span class="line"></span><br><span class="line">        bug         start a bug report</span><br><span class="line">        build       compile packages <span class="keyword">and</span> dependencies</span><br><span class="line">        clean       <span class="builtin-name">remove</span> object files <span class="keyword">and</span> cached files</span><br><span class="line">        doc         show documentation <span class="keyword">for</span> package <span class="keyword">or</span> symbol</span><br><span class="line">        env         <span class="builtin-name">print</span> Go environment information</span><br><span class="line">        fix         update packages <span class="keyword">to</span> use new APIs</span><br><span class="line">        fmt         gofmt (reformat) package sources</span><br><span class="line">        generate    generate Go files by processing source</span><br><span class="line">        <span class="builtin-name">get</span>         download <span class="keyword">and</span> install packages <span class="keyword">and</span> dependencies</span><br><span class="line">        install     compile <span class="keyword">and</span> install packages <span class="keyword">and</span> dependencies</span><br><span class="line">        list        list packages <span class="keyword">or</span> modules</span><br><span class="line">        mod         module maintenance</span><br><span class="line">        <span class="builtin-name">run</span>         compile <span class="keyword">and</span> <span class="builtin-name">run</span> Go program</span><br><span class="line">        test        test packages</span><br><span class="line">       <span class="built_in"> tool </span>       <span class="builtin-name">run</span> specified go tool</span><br><span class="line">        version     <span class="builtin-name">print</span> Go version</span><br><span class="line">        vet         report likely mistakes <span class="keyword">in</span> packages</span><br></pre></td></tr></table></figure><h5 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h5><p> linux系统 下载并解压二进制之后需要手动设置go的环境变量 如go文件解压到目录<code>/usr/local/go</code></p><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">GOROOT</span>=/usr/local/go</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$GOROOT/bin</span><br></pre></td></tr></table></figure><p>此时就能使用go命令 看到帮助提示 说明安装成功。</p><h4 id="命令行认识"><a href="#命令行认识" class="headerlink" title="命令行认识"></a>命令行认识</h4><ul><li>go get 从远程下载package 需要安装与远程包匹配的代码管理工具，如 Git、SVN、HG 等</li><li>go run 运行go文件</li><li>go build 编译go文件 如果代码有误或者语法不正确会报错</li><li>go fmt    格式化代码格式</li><li>go install 编码包文件和整个程序</li><li>go test 运行测试文件 go语言中 <code>xxx_test.go</code> 以下划线test.go结束的文件名为测试文件</li><li>go doc  文件查看</li><li><p>go clean 删除缓存文件</p><p><code>godoc -http=:6060</code> 可在本地启动一个文档服务器 和官方网站的一样哦，方便网络不好的情况下在本地浏览器打开<a href="http://localhost:6060" target="_blank" rel="noopener">http://localhost:6060</a> 就能浏览文档。</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt; go编程语言是一个由Google开源的编程语言项目，它具有很强的表达能力、简洁高效，对并发特别友好，它是一个快速的、静态类型的编译型语言，感觉却像动态类型的解释型语言。&lt;/p&gt;
&lt;h4 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="技术" scheme="http://blog.seoui.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="go" scheme="http://blog.seoui.com/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>再见2018 再见昨天</title>
    <link href="http://blog.seoui.com/2019/01/15/todo2018/"/>
    <id>http://blog.seoui.com/2019/01/15/todo2018/</id>
    <published>2019-01-14T16:00:00.000Z</published>
    <updated>2019-01-15T08:49:51.146Z</updated>
    
    <content type="html"><![CDATA[<p>  <code>自己逼自己回首一下过往 实在写不出东西来了  那么就随便写点流水账啦 ^_^</code></p><p>  <img src="//static.1.seoui.com/images/2019/01/1.jpg" alt=""></p><p>  2018年真滴过完啦 这一切似乎就在昨天、所有的景象就在眼前，今年是很特别的一年 因为在这一年完成了人生中的大事有那么几件。<br>  <a id="more"></a><br>  这是在雾都(重庆)的第9个年头了 依稀记得刚来的时候和几个兄弟伙朝夕挤在一张不足1.5米宽的床上，没日没夜玩着电脑游戏，就连白天饭都顾不上吃 晚上只能去楼下夜市买冒菜吃，这种日子过得轻松(邋遢)了点，但是确实过得很开心 无忧无虑 自由自在的，可惜呀 再也回不去了。</p><p>  后来工作了，每天都是早出晚归的，上班下班，忙得事情可多了，本身干这一行过得相当无趣，有那么一段时间甚至觉得都得了抑郁症了，比较有意义的是每天都会研究或者发明一些小玩意，当然不限于小软件之类的东西，以至于坚持到了现在，陆陆续续的换掉了几份工作 总体来说还是跟着自己的意向在进步，在这段时光里机缘巧合的情况下 遇到了我心爱老婆(也就是前女友)，是她让我在这个冰冷的城市有了归宿感，也是她让我有了努力的理由，虽然我们的日子过得很平凡，但是内心多了一份踏实和牵挂，在我们的共同努力下也装修好了我们的第一套房屋，也算是暂时告别了租房生涯啦！上帝把时间同时共享给了世间的每一个人，我们在一天天的变老，有的亲人也在一天天离开我们，每次回到老家总觉得少点什么。</p><p>  这一年是到目前为止 技术生涯最颓废的一年，就像我以前一个同事(庚)说的，一直在“吃老本”，可能这也是技术人的一个通病，基本上我的工作上已经不涉及前端了，想想之前唯一能吹就是前端了，没想到计划不如变化 竟然…。不过虽然没有专门研究前端了，但是我却收获到了其他的领域的东西，最后还是夸一下自己吧  通过这几年的历程，终究还是能够把自己养得一般般~~ 不畏过去不畏将来^_^。</p><p>  最后18年没有太多想说的了，时常多陪陪亲人朋友 毕竟人生只有这么短短几十年。 希望大家都身体/心理健康、每天多开心一点，其次再是努力生活，努力工作，努力玩！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;  &lt;code&gt;自己逼自己回首一下过往 实在写不出东西来了  那么就随便写点流水账啦 ^_^&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;//static.1.seoui.com/images/2019/01/1.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;  2018年真滴过完啦 这一切似乎就在昨天、所有的景象就在眼前，今年是很特别的一年 因为在这一年完成了人生中的大事有那么几件。&lt;br&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://blog.seoui.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://blog.seoui.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>svn版本控制迁移到git</title>
    <link href="http://blog.seoui.com/2018/11/27/svnToGit/"/>
    <id>http://blog.seoui.com/2018/11/27/svnToGit/</id>
    <published>2018-11-26T16:00:00.000Z</published>
    <updated>2018-11-27T08:53:54.194Z</updated>
    
    <content type="html"><![CDATA[<h4 id="获得原-SVN-仓库使用的作者名字列表"><a href="#获得原-SVN-仓库使用的作者名字列表" class="headerlink" title="获得原 SVN 仓库使用的作者名字列表"></a>获得原 SVN 仓库使用的作者名字列表</h4><p> 因为导入到git需要配置原作者(svn提交人)和git账户的映射关系 其格式为：</p><p> <code>vim authors-transform.txt</code></p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">taoxs = xsTao &lt;xsTao@xxx.com&gt;</span><br><span class="line">lh1 = lh1 &lt;lhl@xxx.com&gt;</span><br></pre></td></tr></table></figure><h4 id="利用-git-svn-克隆-SVN-仓库"><a href="#利用-git-svn-克隆-SVN-仓库" class="headerlink" title="利用 git svn 克隆 SVN 仓库"></a>利用 git svn 克隆 SVN 仓库</h4><p> 新建一个目录作为 Git 项目的根目标，并进入到该目录中，把前面创建的<code>authors-transform.txt</code>用户映射关系复制到这个目录中，执行下面的命令：</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git svn clone $&#123;SVN REP URL &#125; --no-metadata -A authors-transform.txt</span><br></pre></td></tr></table></figure><p>如果SVN的体积/文件有点大得话，那么该过程会持续较长时间。耐心等待</p><p>执行完成后基本上就OK了，把SVN版本库搬到git上来了，但是这个时候还需要提交到远程仓库</p><h4 id="提交GIT版本库到远程仓库"><a href="#提交GIT版本库到远程仓库" class="headerlink" title="提交GIT版本库到远程仓库"></a>提交GIT版本库到远程仓库</h4><p>进入刚刚生成的版本库中 用下面的命令查看分支列表 有不需要的可以删除</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git show-ref</span><br></pre></td></tr></table></figure><p>将refs/remotes 下剩余的引用移动为本地分支</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp -Rf .git/refs/remotes/* .git/refs/heads/</span><br><span class="line">rm -Rf .git/refs/remotes</span><br></pre></td></tr></table></figure><p>为本地仓库添加远程仓库地址 就可以commit/push了</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote add origin ''http://192.168.1.3:8090/osTeam/test.git'</span><br></pre></td></tr></table></figure><p>现在就完美从SVN迁移到GIT了 并保留了原SVN的提交版本记录信息。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;获得原-SVN-仓库使用的作者名字列表&quot;&gt;&lt;a href=&quot;#获得原-SVN-仓库使用的作者名字列表&quot; class=&quot;headerlink&quot; title=&quot;获得原 SVN 仓库使用的作者名字列表&quot;&gt;&lt;/a&gt;获得原 SVN 仓库使用的作者名字列表&lt;/h4&gt;&lt;p&gt; 因
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="svn" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/svn/"/>
    
      <category term="git" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/svn/git/"/>
    
    
      <category term="svn" scheme="http://blog.seoui.com/tags/svn/"/>
    
      <category term="git" scheme="http://blog.seoui.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>让mysql支持emoji表情</title>
    <link href="http://blog.seoui.com/2018/10/22/mysql_emoji_support/"/>
    <id>http://blog.seoui.com/2018/10/22/mysql_emoji_support/</id>
    <published>2018-10-21T16:00:00.000Z</published>
    <updated>2018-10-22T04:40:13.613Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是emoji"><a href="#什么是emoji" class="headerlink" title="什么是emoji"></a>什么是emoji</h4><p>  emoji就是表情符号 emoji的创造者是日本人栗田穰崇(Shigetaka Kurita)</p><p>在数据库的编码不为<code>utf8mb4</code>，利用java mysql驱动保存含有表情符号的数据会出现异常<code>java.sql.SQLException: Incorrect string value: &#39;\xF0\x9F\x94\xA5&#39; for column</code></p><h4 id="mysql中存储emoji表情符号"><a href="#mysql中存储emoji表情符号" class="headerlink" title="mysql中存储emoji表情符号"></a>mysql中存储emoji表情符号</h4><p>  以前做应用软件的时候 通常把<code>mysql</code>的字符编码设置为<code>utf-8</code>，但是这个编码却不支持<code>emoji</code>表情 是因为<code>utf-8</code>编码的一个字符最多只能存储3个字节，但一个emoji表情为4个字节，所以utf8不支持存储emoji表情。</p><p>  mysql中的<code>utf8mb4</code>却能支持<code>emoji</code>表情符号 所以我们只需要更改mysql的数据库编码格式为<code>utf8mb4</code>就能支持了。<em>当然了表和字段也需要是这个编码的，在不手动设置表/字段编码的情况下，会默认继承数据库的编码格式</em>。如果手动修改为字段或者表的编码 也需要手动把表和字段修改为<code>utf8mb4</code></p><h4 id="物理机安装的数据库数据字符编码修改方式"><a href="#物理机安装的数据库数据字符编码修改方式" class="headerlink" title="物理机安装的数据库数据字符编码修改方式"></a>物理机安装的数据库数据字符编码修改方式</h4><p>修改<code>mysql</code>的配置文件<code>/etc/mysql/my.cnf</code> 并重启数据库  如果是编译安装 有可能不是这个目录噢~</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br></pre></td></tr></table></figure><h4 id="云数据库-如阿里云的RDS-修改数据库编码方式"><a href="#云数据库-如阿里云的RDS-修改数据库编码方式" class="headerlink" title="云数据库 如阿里云的RDS 修改数据库编码方式"></a>云数据库 如阿里云的RDS 修改数据库编码方式</h4><p> 找到指定库的参数设置中找到<code>character_set_server</code>修改为<code>utf8mb4</code>并重启数据库</p><h4 id="客户端驱动连接的URL"><a href="#客户端驱动连接的URL" class="headerlink" title="客户端驱动连接的URL"></a>客户端驱动连接的URL</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jdbc:mysql://rr-xxxxx40.mysql.rds.aliyuncs.com:3306/db_test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;characterEncoding=utf-8</span><br></pre></td></tr></table></figure><p>这样就能在<code>mysql</code>中存储<code>emoji</code>表情符号了,<code>utf8mb4</code>是<code>utf-8</code>的超集 意味着反正<code>utf8mb4</code>也能兼容<code>utf-8</code> 在不考虑存储大小的情况下 可以直接把库设置为<code>utf8mb4</code>以免后续烦恼。</p><p>当前测试的数据版本为RDS mysql 5.6.16<br>JAVA驱动版本为5.1.30</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;什么是emoji&quot;&gt;&lt;a href=&quot;#什么是emoji&quot; class=&quot;headerlink&quot; title=&quot;什么是emoji&quot;&gt;&lt;/a&gt;什么是emoji&lt;/h4&gt;&lt;p&gt;  emoji就是表情符号 emoji的创造者是日本人栗田穰崇(Shigetaka Kuri
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="emoji" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/emoji/"/>
    
      <category term="mysql" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/emoji/mysql/"/>
    
    
      <category term="mysql" scheme="http://blog.seoui.com/tags/mysql/"/>
    
      <category term="emoji" scheme="http://blog.seoui.com/tags/emoji/"/>
    
      <category term="mysql支持emoji表情" scheme="http://blog.seoui.com/tags/mysql%E6%94%AF%E6%8C%81emoji%E8%A1%A8%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>springCloud feign使用/优化总结</title>
    <link href="http://blog.seoui.com/2018/09/30/springcloud-feign/"/>
    <id>http://blog.seoui.com/2018/09/30/springcloud-feign/</id>
    <published>2018-09-29T16:00:00.000Z</published>
    <updated>2018-09-30T03:06:58.586Z</updated>
    
    <content type="html"><![CDATA[<p>基于springCloud Dalston.SR3版本</p><h4 id="1-当接口参数是多个的时候-需要指定-RequestParam-中的value来明确一下。"><a href="#1-当接口参数是多个的时候-需要指定-RequestParam-中的value来明确一下。" class="headerlink" title="1.当接口参数是多个的时候 需要指定@RequestParam 中的value来明确一下。"></a>1.当接口参数是多个的时候 需要指定@RequestParam 中的value来明确一下。</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户互扫</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid 被扫人ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userId 当前用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span>(REQ_URL_PRE + <span class="string">"/qrCodeReturnUser"</span>)</span><br><span class="line"><span class="function">UserQrCode <span class="title">qrCodeReturnUser</span><span class="params">(@RequestParam(<span class="string">"uid"</span>)</span> String uid,@<span class="title">RequestParam</span><span class="params">(<span class="string">"userId"</span>)</span> Integer userId)</span>;</span><br></pre></td></tr></table></figure><h4 id="2-接口参数为对象的时候-需要使用-RequestBody注解-并采用POST方式。"><a href="#2-接口参数为对象的时候-需要使用-RequestBody注解-并采用POST方式。" class="headerlink" title="2.接口参数为对象的时候 需要使用@RequestBody注解 并采用POST方式。"></a>2.接口参数为对象的时候 需要使用@RequestBody注解 并采用POST方式。</h4><h4 id="3-如果接口是简单的数组-列表参数-这里需要使用Get请求才行"><a href="#3-如果接口是简单的数组-列表参数-这里需要使用Get请求才行" class="headerlink" title="3.如果接口是简单的数组/列表参数 这里需要使用Get请求才行"></a>3.如果接口是简单的数组/列表参数 这里需要使用Get请求才行</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(REQ_URL_PRE + <span class="string">"/getUserLevels"</span>)</span><br><span class="line"><span class="function">Map&lt;Integer, UserLevel&gt; <span class="title">getUserLevels</span><span class="params">(@RequestParam(<span class="string">"userIds"</span>)</span> List&lt;Integer&gt; userIds)</span>;</span><br></pre></td></tr></table></figure><h4 id="4-直接可以在-FeignClient中配置降级处理方式-对于一些不重要的业务-自定义处理很有帮助"><a href="#4-直接可以在-FeignClient中配置降级处理方式-对于一些不重要的业务-自定义处理很有帮助" class="headerlink" title="4.直接可以在@FeignClient中配置降级处理方式 对于一些不重要的业务 自定义处理很有帮助"></a>4.直接可以在<code>@FeignClient</code>中配置降级处理方式 对于一些不重要的业务 自定义处理很有帮助</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"cloud-user"</span>, fallback = IUsers.UsersFallback.class)</span><br></pre></td></tr></table></figure><h4 id="5-feign默认只有HystrixBadRequestException异常不会走熔断，其它任何异常都会进入熔断，需要重新实现一下ErrorDecoder包装业务异常"><a href="#5-feign默认只有HystrixBadRequestException异常不会走熔断，其它任何异常都会进入熔断，需要重新实现一下ErrorDecoder包装业务异常" class="headerlink" title="5.feign默认只有HystrixBadRequestException异常不会走熔断，其它任何异常都会进入熔断，需要重新实现一下ErrorDecoder包装业务异常"></a>5.<code>feign</code>默认只有<code>HystrixBadRequestException</code>异常不会走熔断，其它任何异常都会进入熔断，需要重新实现一下<code>ErrorDecoder</code>包装业务异常</h4><p>  示例：<a href="https://github.com/peachyy/feign-support" target="_blank" rel="noopener">https://github.com/peachyy/feign-support</a></p><h4 id="6-feign-HTTP请求方式选择"><a href="#6-feign-HTTP请求方式选择" class="headerlink" title="6. feign HTTP请求方式选择"></a>6. feign HTTP请求方式选择</h4><p><code>feign</code>默认使用的是基于JDK提供的URLConnection调用HTTP接口，不具备连接池。所以资源开销上有点影响，经测试JDK的<code>URLConnection</code>比<code>Apache HttpClient</code>快很多倍。但是<code>Apache HttpClient</code>和<code>okhttp</code>都支持配置连接池功能。具体选择需要权衡</p><h4 id="7-默认不启用hystrix-需要手动指定feign-hystrix-enabled-true-开启熔断"><a href="#7-默认不启用hystrix-需要手动指定feign-hystrix-enabled-true-开启熔断" class="headerlink" title="7.默认不启用hystrix 需要手动指定feign.hystrix.enabled=true 开启熔断"></a>7.默认不启用<code>hystrix</code> 需要手动指定<code>feign.hystrix.enabled=true</code> 开启熔断</h4><h4 id="8-启用压缩也是一种有效的优化方式"><a href="#8-启用压缩也是一种有效的优化方式" class="headerlink" title="8.启用压缩也是一种有效的优化方式"></a>8.启用压缩也是一种有效的优化方式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">feign.compression.request.enabled=<span class="keyword">true</span></span><br><span class="line">feign.compression.response.enabled=<span class="keyword">true</span></span><br><span class="line">feign.compression.request.mime-types=text/xml,application/xml,application/json</span><br></pre></td></tr></table></figure><h4 id="9-参数相关调优"><a href="#9-参数相关调优" class="headerlink" title="9.参数相关调优"></a>9.参数相关调优</h4><h5 id="hystrix线程数设置"><a href="#hystrix线程数设置" class="headerlink" title="hystrix线程数设置"></a>hystrix线程数设置</h5><p>设置参数<code>hystrix.threadpool.default.coreSize</code> 来指定熔断隔离的线程数 这个数需要调优，经测试 线程数我们设置为和提供方的容器线程差不多，吞吐量高许多。</p><h5 id="第一次访问服务出错的问题"><a href="#第一次访问服务出错的问题" class="headerlink" title="第一次访问服务出错的问题"></a>第一次访问服务出错的问题</h5><p>启用<code>Hystrix</code>后，很多服务当第一次访问的时候都会失败 是因为初始化负载均衡一系列操作已经超出了超时时间了 默认的超时时间为<code>1S</code>，设置参数超时时间<code>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=30000</code> 可解决这个问题。</p><h5 id="负载均衡参数设置"><a href="#负载均衡参数设置" class="headerlink" title="负载均衡参数设置"></a>负载均衡参数设置</h5><p>设置了<code>Hystrix</code>的超时参数会 还需设置一下<code>ribbon</code>的相关参数  这些参数和<code>Hystrix</code>的超时参数有一定的逻辑关系<br>请求处理的超时时间 <code>ribbon.ReadTimeout=120000</code><br>请求连接的超时时间 <code>ribbon.ConnectTimeout=30000</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;基于springCloud Dalston.SR3版本&lt;/p&gt;
&lt;h4 id=&quot;1-当接口参数是多个的时候-需要指定-RequestParam-中的value来明确一下。&quot;&gt;&lt;a href=&quot;#1-当接口参数是多个的时候-需要指定-RequestParam-中的value来
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="springCloud" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/springCloud/"/>
    
      <category term="feign" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/springCloud/feign/"/>
    
    
      <category term="feign" scheme="http://blog.seoui.com/tags/feign/"/>
    
      <category term="springCloud" scheme="http://blog.seoui.com/tags/springCloud/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq4.x批量消息投递</title>
    <link href="http://blog.seoui.com/2018/08/02/rocketmq_batch_message/"/>
    <id>http://blog.seoui.com/2018/08/02/rocketmq_batch_message/</id>
    <published>2018-08-01T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.891Z</updated>
    
    <content type="html"><![CDATA[<p> 批量发送消息可提高传递小消息的性能。同时也需要满足以下特征</p><ul><li>批量消息要求必要具有同一<code>topic</code>、相同消息配置</li><li><code>不支持延时消息</code></li><li>建议一个批量消息最好不要超过1MB大小<a id="more"></a><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4></li></ul><p>小于1MB</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String topic = <span class="string">"BatchTest"</span>;</span><br><span class="line">List&lt;Message&gt; messages = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">messages.add(<span class="keyword">new</span> Message(topic, <span class="string">"TagA"</span>, <span class="string">"Order1"</span>, <span class="string">"Hello world 0"</span>.getBytes()));</span><br><span class="line">messages.add(<span class="keyword">new</span> Message(topic, <span class="string">"TagA"</span>, <span class="string">"Order2"</span>, <span class="string">"Hello world 1"</span>.getBytes()));</span><br><span class="line">messages.add(<span class="keyword">new</span> Message(topic, <span class="string">"TagA"</span>, <span class="string">"Order3"</span>, <span class="string">"Hello world 2"</span>.getBytes()));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">producer.send(messages);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大于1MB也可以使用分割消息的方式进行多次批量发送。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 批量发送消息可提高传递小消息的性能。同时也需要满足以下特征&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;批量消息要求必要具有同一&lt;code&gt;topic&lt;/code&gt;、相同消息配置&lt;/li&gt;
&lt;li&gt;&lt;code&gt;不支持延时消息&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;建议一个批量消息最好不要超过1MB大小
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq4.x延时消息</title>
    <link href="http://blog.seoui.com/2018/08/01/rocketmq_delay_message/"/>
    <id>http://blog.seoui.com/2018/08/01/rocketmq_delay_message/</id>
    <published>2018-07-31T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.888Z</updated>
    
    <content type="html"><![CDATA[<p><code>rocketmq</code>提供一种延时消息的解决方案，就是在特定的时间到了，消息才会被投递出去供<code>consumer</code>消费。<br><a id="more"></a><br><em>总体来是简单的场景是满足了，但是需要注意的是延时的时间是需要按照默认配置的延时级别去配置的，而不是随意设置消息的延时时间。</em></p><p>如果想不受延时级别的约束 可以参考之前的一遍文章<a href="http://blog.seoui.com/2017/08/19/delayqueue/">http://blog.seoui.com/2017/08/19/delayqueue/</a></p><p>默认的延迟级别</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">messageDelayLevel=<span class="number">1</span>s <span class="number">5</span>s <span class="number">10</span>s <span class="number">30</span>s <span class="number">1</span>m <span class="number">2</span>m <span class="number">3</span>m <span class="number">4</span>m <span class="number">5</span>m <span class="number">6</span>m <span class="number">7</span>m <span class="number">8</span>m <span class="number">9</span>m <span class="number">10</span>m <span class="number">20</span>m <span class="number">30</span>m <span class="number">1</span>h <span class="number">2</span>h</span><br></pre></td></tr></table></figure><p>这个配置下标从1开始 比如级别2是延时5秒、级别5是延时1分钟。默认配置在不满足需求的情况下，可以在<code>broker</code>配置文件加入<code>messageDelayLevel</code>参数覆盖默认的延时级别配置。</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>和普通的消息不同之处在于<code>Producer</code>在发送消息的时候 需要设置<code>message.setDelayTimeLevel();</code>延迟级别方法。其他参数和消费端的写法并与不同之处。</p><h5 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledMessageProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DefaultMQProducer producer = </span><br><span class="line"><span class="keyword">new</span> DefaultMQProducer(<span class="string">"ExampleProducerGroup"</span>);</span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="keyword">int</span> totalMessagesToSend = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; totalMessagesToSend; i++) &#123;</span><br><span class="line">            Message message = <span class="keyword">new</span> Message(<span class="string">"TestTopic"</span>,</span><br><span class="line">(<span class="string">"Hello scheduled message "</span> + i).getBytes());</span><br><span class="line"> <span class="comment">//延时的级别为3 对应的时间为10s 就是发送后延时10S在把消息投递出去</span></span><br><span class="line">            message.setDelayTimeLevel(<span class="number">3</span>);</span><br><span class="line">            producer.send(message);</span><br><span class="line">        &#125;</span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledMessageConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DefaultMQPushConsumer consumer = </span><br><span class="line"><span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"ExampleConsumer"</span>);</span><br><span class="line">        consumer.subscribe(<span class="string">"TestTopic"</span>, <span class="string">"*"</span>);</span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerConcurrently() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; messages,</span></span></span><br><span class="line"><span class="function"><span class="params"> ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt message : messages) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"ok!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;rocketmq&lt;/code&gt;提供一种延时消息的解决方案，就是在特定的时间到了，消息才会被投递出去供&lt;code&gt;consumer&lt;/code&gt;消费。&lt;br&gt;
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq4.x快速入门指南</title>
    <link href="http://blog.seoui.com/2018/07/24/rocketmqinstall/"/>
    <id>http://blog.seoui.com/2018/07/24/rocketmqinstall/</id>
    <published>2018-07-23T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.886Z</updated>
    
    <content type="html"><![CDATA[<p>以下采用的是<code>apache rocketmq 4.2.0</code>版本 相关文档如下</p><ul><li>快速体验： <a href="//blog.seoui.com/2018/07/24/rocketmqinstall/">http://blog.seoui.com/2018/07/24/rocketmqinstall/</a> </li><li>rocketmq简单消息发送： <a href="//blog.seoui.com/2018/07/24/rocketmq_simple_message/">http://blog.seoui.com/2018/07/24/rocketmq_simple_message/</a> </li><li>rocketmq有序消息： <a href="//blog.seoui.com/2018/07/24/rocketmq_ordered_message/">http://blog.seoui.com/2018/07/24/rocketmq_ordered_message/</a> </li><li>rocketmq广播消息： <a href="//blog.seoui.com/2018/07/24/rocketmq_broadcast_message/">http://blog.seoui.com/2018/07/24/rocketmq_broadcast_message/</a> </li><li>rocketmq延时消息： <a href="//blog.seoui.com/2018/08/01/rocketmq_delay_message/">http://blog.seoui.com/2018/08/01/rocketmq_delay_message/</a></li><li>rocketmq批量消息： <a href="//blog.seoui.com/2018/08/02/rocketmq_batch_message/">http://blog.seoui.com/2018/08/02/rocketmq_batch_message/</a><h4 id="下载源码并编译"><a href="#下载源码并编译" class="headerlink" title="下载源码并编译"></a>下载源码并编译</h4></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#download</span></span><br><span class="line">wget http://mirrors.hust.edu.cn/apache/rocketmq/4.2.0/rocketmq-all-4.2.0-source-release.zip   </span><br><span class="line">unzip rocketmq-all-4.2.0-source-release.zip</span><br><span class="line"><span class="built_in">cd</span> rocketmq-all-4.2.0/</span><br><span class="line">mvn -Prelease-all -DskipTests clean install -U</span><br><span class="line"><span class="built_in">cd</span> distribution/target/apache-rocketmq</span><br></pre></td></tr></table></figure><p>目录 <code>distribution/target/apache-rocketmq</code> 是编译后的产出 可复制这个目录安装MQ的机器上,这里复制到<code>/usr/local/</code></p><p>共享一份编译后的文件方便以后再次使用 </p><p><a href="https://pan.baidu.com/s/1ZyUOKFm-t8cJDQuH68QydQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1ZyUOKFm-t8cJDQuH68QydQ</a></p><h4 id="启动NameServer"><a href="#启动NameServer" class="headerlink" title="启动NameServer"></a>启动NameServer</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/apache-rocketmq</span><br><span class="line">nohup sh bin/mqnamesrv &amp;</span><br></pre></td></tr></table></figure><p> 查看日志<code>tail -f ~/logs/rocketmqlogs/namesrv.log</code> 启动成功后打印The Name Server boot success…</p><h4 id="启动Broker"><a href="#启动Broker" class="headerlink" title="启动Broker"></a>启动Broker</h4><p>这里需要注意一下就是 如果当前机器上有多张网卡的情况,最好指定一个<code>IP</code>, 有可能消费端正好就和MQ选择的网卡不通</p><p><code>vim  conf/broker.conf</code> 指定IP 访问多网卡的情况 并配置好nameserver的地址  也可以使用mqbroker启动参数<code>-n</code>指定nameserver地址</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brokerIP1=192.168.1.2</span><br><span class="line">namesrvAddr=192.168.1.3:9876</span><br></pre></td></tr></table></figure><p>启动broker <code>-c</code>参数指定配置文件</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nohup sh bin/mqbroker -c config/broker.properties &amp;</span><br></pre></td></tr></table></figure><p>查看一下集群列表</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh bin/mqadmin clusterList -n  localhost:9876</span><br></pre></td></tr></table></figure><h4 id="发送-接收消息"><a href="#发送-接收消息" class="headerlink" title="发送/接收消息"></a>发送/接收消息</h4><p>Producer</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="built_in">export</span> NAMESRV_ADDR=localhost:9876</span><br><span class="line">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure><p>能发送表示OK</p><p>Consumer</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="built_in">export</span> NAMESRV_ADDR=localhost:9876</span><br><span class="line">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure><p>能接收到之前发送的消息表示OK</p><h4 id="关闭MQ"><a href="#关闭MQ" class="headerlink" title="关闭MQ"></a>关闭MQ</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line">sh bin/mqshutdown broker</span><br><span class="line"></span><br><span class="line">sh bin/mqshutdown namesrv</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;以下采用的是&lt;code&gt;apache rocketmq 4.2.0&lt;/code&gt;版本 相关文档如下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;快速体验： &lt;a href=&quot;//blog.seoui.com/2018/07/24/rocketmqinstall/&quot;&gt;http://blog.s
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq简单消息发送</title>
    <link href="http://blog.seoui.com/2018/07/24/rocketmq_simple_message/"/>
    <id>http://blog.seoui.com/2018/07/24/rocketmq_simple_message/</id>
    <published>2018-07-23T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.884Z</updated>
    
    <content type="html"><![CDATA[<p>有以下3种方式发送RocketMQ消息 </p><ul><li>可靠同步发送 reliable synchronous</li><li>可靠异步发送 reliable asynchronous</li><li>单向发送 one-way transmission</li></ul><h4 id="可靠同步发送"><a href="#可靠同步发送" class="headerlink" title="可靠同步发送"></a>可靠同步发送</h4><p> 主要运用在比较重要一点消息传递/通知等业务</p> <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DefaultMQProducer producer = <span class="keyword">new</span></span><br><span class="line">            DefaultMQProducer(<span class="string">"test"</span>);</span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            Message msg = <span class="keyword">new</span> Message(<span class="string">"TopicTest"</span> <span class="comment">/* Topic */</span>,</span><br><span class="line">                <span class="string">"TagA"</span> <span class="comment">/* Tag */</span>,</span><br><span class="line">                (<span class="string">"Hello RocketMQ "</span> +</span><br><span class="line">                    i).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class="comment">/* Message body */</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">//Call send message to deliver message to one of brokers.</span></span><br><span class="line">            SendResult sendResult = producer.send(msg);</span><br><span class="line">            System.out.printf(<span class="string">"%s%n"</span>, sendResult);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Shut down once the producer instance is not longer in use.</span></span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="可靠异步发送"><a href="#可靠异步发送" class="headerlink" title="可靠异步发送"></a>可靠异步发送</h4><p>  通常用于对发送消息响应时间要求更高/更快的场景</p><pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncProducer</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(</span></span><span class="function"><span class="params">        String[] args)</span> <span class="keyword">throws</span> MQClientException, InterruptedException, UnsupportedEncodingException </span>{        DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(<span class="string">"Jodie_Daily_test"</span>);        producer.start();        producer.setRetryTimesWhenSendAsyncFailed(<span class="number">0</span>);        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) {            <span class="keyword">try</span> {                <span class="keyword">final</span> <span class="keyword">int</span> index = i;                Message msg = <span class="keyword">new</span> Message(<span class="string">"Jodie_topic_1023"</span>,                    <span class="string">"TagA"</span>,                    <span class="string">"OrderID188"</span>,                    <span class="string">"Hello world"</span>.getBytes(RemotingHelper.DEFAULT_CHARSET));                    <span class="comment">//重点在这里 异步发送回调</span>                producer.send(msg, <span class="keyword">new</span> SendCallback() {                    <span class="meta">@Override</span>                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(SendResult sendResult)</span> </span>{                        System.out.printf(<span class="string">"%-10d OK %s %n"</span>, index, sendResult.getMsgId());                    }                    <span class="meta">@Override</span>                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(Throwable e)</span> </span>{                        System.out.printf(<span class="string">"%-10d Exception %s %n"</span>, index, e);                        e.printStackTrace();                    }                });            } <span class="keyword">catch</span> (Exception e) {                e.printStackTrace();            }        }        producer.shutdown();    }}</code></pre><h4 id="单向发送"><a href="#单向发送" class="headerlink" title="单向发送"></a>单向发送</h4><p>适用于某些耗时非常短，但对可靠性要求并不高的场景，例如日志收集。</p><p><em>只发送消息，不等待服务器响应，只发送请求不等待应答。此方式发送消息的过程耗时非常短，一般在微秒级别。</em></p><pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnewayProducer</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>{        DefaultMQProducer producer = <span class="keyword">new</span> DefaultMQProducer(<span class="string">"Test"</span>);        producer.start();        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {            <span class="comment">//Create a message instance, specifying topic, tag and message body.</span>            Message msg = <span class="keyword">new</span> Message(<span class="string">"TopicTest"</span> <span class="comment">/* Topic */</span>,                <span class="string">"TagA"</span> <span class="comment">/* Tag */</span>,                (<span class="string">"Hello RocketMQ "</span> +                    i).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class="comment">/* Message body */</span>            );            <span class="comment">//Call send message to deliver message to one of brokers.</span>            producer.sendOneway(msg);        }        <span class="comment">//Shut down once the producer instance is not longer in use.</span>        producer.shutdown();    }}</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;有以下3种方式发送RocketMQ消息 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可靠同步发送 reliable synchronous&lt;/li&gt;
&lt;li&gt;可靠异步发送 reliable asynchronous&lt;/li&gt;
&lt;li&gt;单向发送 one-way transmission&lt;/l
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq有序消息</title>
    <link href="http://blog.seoui.com/2018/07/24/rocketmq_ordered_message/"/>
    <id>http://blog.seoui.com/2018/07/24/rocketmq_ordered_message/</id>
    <published>2018-07-23T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.882Z</updated>
    
    <content type="html"><![CDATA[<p>RocketMQ提供的顺序消费消息实现是使用的FIFO 先进先出算法</p><h4 id="Producer消息发送"><a href="#Producer消息发送" class="headerlink" title="Producer消息发送"></a>Producer消息发送</h4> <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MQProducer producer = <span class="keyword">new</span> DefaultMQProducer(<span class="string">"please_rename_unique_group_name"</span>);</span><br><span class="line">            producer.start();</span><br><span class="line"></span><br><span class="line">            String[] tags = <span class="keyword">new</span> String[] &#123;<span class="string">"TagA"</span>, <span class="string">"TagB"</span>, <span class="string">"TagC"</span>, <span class="string">"TagD"</span>, <span class="string">"TagE"</span>&#125;;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> orderId = i % <span class="number">10</span>;</span><br><span class="line">                Message msg =</span><br><span class="line">                    <span class="keyword">new</span> Message(<span class="string">"TopicTestjjj"</span>, tags[i % tags.length], <span class="string">"KEY"</span> + i,</span><br><span class="line">                        (<span class="string">"Hello RocketMQ "</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET));</span><br><span class="line">                SendResult sendResult = producer.send(msg, <span class="keyword">new</span> MessageQueueSelector() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> MessageQueue <span class="title">select</span><span class="params">(List&lt;MessageQueue&gt; mqs, Message msg, Object arg)</span> </span>&#123;</span><br><span class="line">                        Integer id = (Integer) arg;</span><br><span class="line">                        <span class="keyword">int</span> index = id % mqs.size();</span><br><span class="line">                        <span class="keyword">return</span> mqs.get(index);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, orderId);</span><br><span class="line"></span><br><span class="line">                System.out.printf(<span class="string">"%s%n"</span>, sendResult);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            producer.shutdown();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MQClientException | RemotingException | MQBrokerException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Consumer消息消费"><a href="#Consumer消息消费" class="headerlink" title="Consumer消息消费"></a>Consumer消息消费</h4><pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException </span>{        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"please_rename_unique_group_name_3"</span>);        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);        consumer.subscribe(<span class="string">"TopicTest"</span>, <span class="string">"TagA || TagC || TagD"</span>);        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerOrderly() {            AtomicLong consumeTimes = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);            <span class="meta">@Override</span>            <span class="function"><span class="keyword">public</span> ConsumeOrderlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context)</span> </span>{                context.setAutoCommit(<span class="keyword">false</span>);                System.out.printf(<span class="string">"%s Receive New Messages: %s %n"</span>, Thread.currentThread().getName(), msgs);                <span class="keyword">this</span>.consumeTimes.incrementAndGet();                <span class="keyword">if</span> ((<span class="keyword">this</span>.consumeTimes.get() % <span class="number">2</span>) == <span class="number">0</span>) {                    <span class="keyword">return</span> ConsumeOrderlyStatus.SUCCESS;                } <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">this</span>.consumeTimes.get() % <span class="number">3</span>) == <span class="number">0</span>) {                    <span class="keyword">return</span> ConsumeOrderlyStatus.ROLLBACK;                } <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">this</span>.consumeTimes.get() % <span class="number">4</span>) == <span class="number">0</span>) {                    <span class="keyword">return</span> ConsumeOrderlyStatus.COMMIT;                } <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">this</span>.consumeTimes.get() % <span class="number">5</span>) == <span class="number">0</span>) {                    context.setSuspendCurrentQueueTimeMillis(<span class="number">3000</span>);                    <span class="keyword">return</span> ConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENT;                }                <span class="keyword">return</span> ConsumeOrderlyStatus.SUCCESS;            }        });        consumer.start();        System.out.printf(<span class="string">"Consumer Started.%n"</span>);    }}</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;RocketMQ提供的顺序消费消息实现是使用的FIFO 先进先出算法&lt;/p&gt;
&lt;h4 id=&quot;Producer消息发送&quot;&gt;&lt;a href=&quot;#Producer消息发送&quot; class=&quot;headerlink&quot; title=&quot;Producer消息发送&quot;&gt;&lt;/a&gt;Producer
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>rocketmq广播消息</title>
    <link href="http://blog.seoui.com/2018/07/24/rocketmq_broadcast_message/"/>
    <id>http://blog.seoui.com/2018/07/24/rocketmq_broadcast_message/</id>
    <published>2018-07-23T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.879Z</updated>
    
    <content type="html"><![CDATA[<p>发布与模式实现。广播就是向一个主题的所有订阅者发送同一条消息。</p><p>在发送消息的时候和普通的消息并与不同之处，只是在消费端做一些配置即可。</p><h4 id="Consumer消息消费"><a href="#Consumer消息消费" class="headerlink" title="Consumer消息消费"></a>Consumer消息消费</h4><pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BroadcastConsumer</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException </span>{        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(<span class="string">"please_rename_unique_group_name_3"</span>);        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);        <span class="comment">//设置为广播模式 默认为CLUSTERING模式</span>        consumer.setMessageModel(MessageModel.BROADCASTING);        consumer.subscribe(<span class="string">"TopicTest"</span>, <span class="string">"TagA || TagC || TagD"</span>);        consumer.registerMessageListener(<span class="keyword">new</span> MessageListenerOrderly() {            AtomicLong consumeTimes = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);            <span class="meta">@Override</span>            <span class="function"><span class="keyword">public</span> ConsumeOrderlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context)</span> </span>{                context.setAutoCommit(<span class="keyword">false</span>);                System.out.printf(<span class="string">"%s Receive New Messages: %s %n"</span>, Thread.currentThread().getName(), msgs);                <span class="keyword">return</span> ConsumeOrderlyStatus.SUCCESS;            }        });        consumer.start();        System.out.printf(<span class="string">"Consumer Started.%n"</span>);    }}</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;发布与模式实现。广播就是向一个主题的所有订阅者发送同一条消息。&lt;/p&gt;
&lt;p&gt;在发送消息的时候和普通的消息并与不同之处，只是在消费端做一些配置即可。&lt;/p&gt;
&lt;h4 id=&quot;Consumer消息消费&quot;&gt;&lt;a href=&quot;#Consumer消息消费&quot; class=&quot;heade
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="rocketmq" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/rocketmq/"/>
    
    
      <category term="rocketmq" scheme="http://blog.seoui.com/tags/rocketmq/"/>
    
  </entry>
  
  <entry>
    <title>gitlab环境搭建</title>
    <link href="http://blog.seoui.com/2018/06/22/gitlabinstall/"/>
    <id>http://blog.seoui.com/2018/06/22/gitlabinstall/</id>
    <published>2018-06-21T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.872Z</updated>
    
    <content type="html"><![CDATA[<p>操作系统：<code>centos7</code><br>gitlab： <code>gitlab-ee</code></p><p>如果是其他环境 安装过程类似</p><h4 id="安装必要依赖"><a href="#安装必要依赖" class="headerlink" title="安装必要依赖"></a>安装必要依赖</h4> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br></pre></td></tr></table></figure><p> 安装<code>postfix</code>依赖 用来发送邮件 不需要可以省略</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">sudo systemctl start postfix</span><br></pre></td></tr></table></figure><h4 id="获取并安装GitLab包"><a href="#获取并安装GitLab包" class="headerlink" title="获取并安装GitLab包"></a>获取并安装GitLab包</h4><p>  添加package</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><p>  执行安装操作</p><p>  <em>设置一个EXTERNAL_URL表示安装后的gitlab地址,如果需要HTTPS 那么需求安装好之后额外配置</em></p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo EXTERNAL_URL=<span class="string">"http://172.30.34.6/"</span> yum install -y gitlab-ee</span><br></pre></td></tr></table></figure><p>  如果没有报错信息 就可以使用前面配置的<code>EXTERNAL_URL</code>参数在浏览器上打开GITLAB了，当前配置的URL为:<code>http://172.30.34.6/</code></p><h4 id="安装之后首次访问设置"><a href="#安装之后首次访问设置" class="headerlink" title="安装之后首次访问设置"></a>安装之后首次访问设置</h4><p>  安装好之后默认需要使用<code>root</code>账户登录，这个时候浏览器会重定向到为<code>root</code>设置初次密码的页面，跟着操作做就对了。</p><p><code>Gitlab</code>安装好之后提供了一系列的命令工具如：<code>gitlab-ctl</code>等等。</p><p>  更多设置请参考官方文档</p><p>参考</p><p><a href="https://about.gitlab.com/installation/#centos-7" target="_blank" rel="noopener">https://about.gitlab.com/installation/#centos-7</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;操作系统：&lt;code&gt;centos7&lt;/code&gt;&lt;br&gt;gitlab： &lt;code&gt;gitlab-ee&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果是其他环境 安装过程类似&lt;/p&gt;
&lt;h4 id=&quot;安装必要依赖&quot;&gt;&lt;a href=&quot;#安装必要依赖&quot; class=&quot;headerlink
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="gitlab" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/gitlab/"/>
    
    
      <category term="gitlab" scheme="http://blog.seoui.com/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>nexus3.X环境搭建</title>
    <link href="http://blog.seoui.com/2018/06/22/nexusinstall/"/>
    <id>http://blog.seoui.com/2018/06/22/nexusinstall/</id>
    <published>2018-06-21T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.877Z</updated>
    
    <content type="html"><![CDATA[<p>nexus3比以前的版本相比 多支持了管理不同的格式 比如<code>Docker</code> <code>npm</code> <code>NuGet</code> <code>maven</code> …等</p><h4 id="下载编译好的二进制安装"><a href="#下载编译好的二进制安装" class="headerlink" title="下载编译好的二进制安装"></a>下载编译好的二进制安装</h4> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://sonatype-download.global.ssl.fastly.net/repository/repositoryManager/3/nexus-3.12.1-01-unix.tar.gz</span><br><span class="line">  </span><br><span class="line">  tar -zxf nexus-3.12.1-01-unix.tar.gz </span><br><span class="line"> </span><br><span class="line">  <span class="built_in">cd</span> nexus-3.12.1-01/</span><br><span class="line">  bin/nexus start</span><br></pre></td></tr></table></figure><p> 默认的端口号为<code>8081</code> nexus3.x和以前的版本界面都有很大的改变 需要注意一下。<br> 其他默认配置在文件<code>etc/nexus-default.properties</code>中 需要修改的关注一下。</p><p>参考</p><p><a href="https://www.sonatype.com/" target="_blank" rel="noopener">https://www.sonatype.com/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;nexus3比以前的版本相比 多支持了管理不同的格式 比如&lt;code&gt;Docker&lt;/code&gt; &lt;code&gt;npm&lt;/code&gt; &lt;code&gt;NuGet&lt;/code&gt; &lt;code&gt;maven&lt;/code&gt; …等&lt;/p&gt;
&lt;h4 id=&quot;下载编译好的二进制安装&quot;&gt;&lt;a hr
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="nexus3" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/nexus3/"/>
    
    
      <category term="nexus3" scheme="http://blog.seoui.com/tags/nexus3/"/>
    
  </entry>
  
  <entry>
    <title>jenkins环境搭建</title>
    <link href="http://blog.seoui.com/2018/06/22/jenkinsinstall/"/>
    <id>http://blog.seoui.com/2018/06/22/jenkinsinstall/</id>
    <published>2018-06-21T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.875Z</updated>
    
    <content type="html"><![CDATA[<p><code>Jenkins</code>是基于<code>JVM</code>开发的，所以安装之前需要先确保装好<code>JVM</code>的运行环境<code>JRE</code></p><p> 这里采用<code>TOMCAT</code>的部署方式安装。</p><h4 id="下载WAR"><a href="#下载WAR" class="headerlink" title="下载WAR"></a>下载WAR</h4> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://mirrors.jenkins.io/war-stable/2.121.1/jenkins.war</span><br></pre></td></tr></table></figure><p> 然后复制到<code>tomcat</code>的webapps目录中 执行<code>bin/startup.sh</code>启动 ，<code>bin/shutdown.sh</code> 关闭。</p><p> 首次启动访问的时候会提示你安装插件 选中推荐的一些插件就基本够用了。也可以在系统设置-&gt;插件管理中手动安装。</p><p>参考</p><p><a href="https://jenkins.io/doc/" target="_blank" rel="noopener">https://jenkins.io/doc/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;Jenkins&lt;/code&gt;是基于&lt;code&gt;JVM&lt;/code&gt;开发的，所以安装之前需要先确保装好&lt;code&gt;JVM&lt;/code&gt;的运行环境&lt;code&gt;JRE&lt;/code&gt;&lt;/p&gt;
&lt;p&gt; 这里采用&lt;code&gt;TOMCAT&lt;/code&gt;的部署方式安装。&lt;/p&gt;
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="jenkins" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/jenkins/"/>
    
    
      <category term="jenkins" scheme="http://blog.seoui.com/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>base64文件大小计算</title>
    <link href="http://blog.seoui.com/2018/05/09/base64_file_size/"/>
    <id>http://blog.seoui.com/2018/05/09/base64_file_size/</id>
    <published>2018-05-08T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.869Z</updated>
    
    <content type="html"><![CDATA[<p>有时候图片被<code>base64</code>之后需要计算图片大小，因为被编码后全是字符，计算文件大小可以反序列化成文件之后再获取大小，但是会比较麻烦。简单介绍一种利用<code>base64</code>编码原理计算大小的方法。</p><h4 id="编码原理"><a href="#编码原理" class="headerlink" title="编码原理"></a>编码原理</h4><p>要求把<code>3</code>个<code>8</code>位字节<code>（3*8=24）</code>转化为<code>4</code>个<code>6</code>位的字节<code>（4*6=24）</code>，之后在6位的前面补两个0，形成8位一个字节的形式。 如果剩下的字符不足<code>3</code>个字节，用<code>0</code>填充，输出字符使用<code>’=’</code>，因此编码后输出的文本末尾可能会出现<code>1</code>或<code>2</code>个<code>’=’</code></p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>找一张图片文件<code>https://www.baidu.com/img/bd_logo1.png</code> 下载到本地<code>base64</code>编码之后的图片显示结果如下</p><p><img id="imgcase" width="70px" height="0px" src="data:image/png;base64,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0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMAUExURQAAAP///+EGASMZ3Pz7/vX0/fb1/fLx/fPy/fTz/TIo3kY94UxD4l9X5XJr6Hdw6Xhx6YR+64uF7JqV75uW75yX752Y76Sf8K+r8rGt87ay88fE9snG9s/M99DN99bU+NjW+drY+dza+eLg+uvq/Ozr/O3s/O7t/O/u/CQa3CYc3Cce3Sge3Ssh3Swi3Swj3i0k3i4l3i8m3jAn3jMq3zQr3zUs3zYt3zcu3zgv3zkw4Dkw3zox4Dsy4Dwz4D004D414D834UA44UI54UM64UQ74UU84UY+4khA4kpC4k1F409H41JK41JL5FNM5FZO5FlR5VtU5VxV5V9Y5mFa5mNc5mRd5mVe52Zf52dg52hh52li52pj52tl6G5n6G9o6HNt6XRu6Xlz6nt16n136n546n9664F764J864R/7IaB7IiD7IuG7Y2I7Y+K7ZGM7pCL7ZKN7pGM7ZOO7pSP7paR7piU75+b8KCc8KSg8aej8aik8auo8rKv87Sx87e09Lm29Lu49Ly59L+89cG+9cPB9sXD9svJ983L99DO+NPR+NTS+N7d+uDf+uPi++Tj++Xk++bl++fm++no/Ojn++rp/Ono+/Dw/fb2/vn5/vr6/vz8//7+//zo5/3r6uMTDuMUD+MVEOMWEeMXEuMYE+MaFfCFgvGHhPGJhvGOi/KRjvKUkfKWk/Shn/SmpPWpp/WsqvWurPa0sve5t/e6uPe9u/e/vffBv/rT0vrU0/rW1frY1/va2fvc2/vd3Pvg3/zj4vvi4fzl5Pzn5uEHAuEIA+EJBOEKBeILBuIMB+INCOIPCuIQC+QbF+QdGeQfG+QgHOUjH+UlIeUpJeUqJuYtKeYvK+YzL+c2Muc5Nec8OOg+OuhAPOlEQelGQ+lIRelKR+lMSepPTOtWU+tZVuteW+xiX+1mY+1qZ+1tau5wbu92dO99e/B/ffCAfvCCgPOZl/OenPjBwPjEw/jGxfnJyPnMy/nPzv3u7v3w8P719f729v75+f/7+//9/f///4DJalUAAAEAdFJOU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wBT9wclAAAP2klEQVR42uzdaXwURRoGcKsrJEAIi0G5A4RATEICaBQWMYiEXcGA4Y6yHIICcikKAlkuJYRICCLHLklmhMUgghwiiAguiC6IcsgRORRRdzlFFLwRE377wWRm+qjq7pnumeme5/mYeaeH6frT3dNVXXUTQRBGbsIuQIADAQ4EOBDgQIADAQ4EOBDgQIADAQ4EAQ4EOBDgQIADAQ4EOBDgQIADAQ4EOBAEOBDgQIADAQ4EOBDgQIADAQ4EOBDgQBDgQIADAQ4EOBDgQIADAQ4EOBDgQIADAQ4EAQ4EOBDgQIADAQ4EOBDgQIADAQ4EOBAEOBDgQIADAQ4EOBDgQIADAQ4EOBDgQBDgQIADAQ4EOBDgQIADAQ4EOBDgQIADAQ4EAQ4EOBDgQIADAQ4EOBDgQIADAQ4EOBAEOBDgQIADAQ4EOBDgQIADAQ4EOBDgQBDgQIADAQ4EOHzP0uyH7klO6TSofiEIAIcohU+0oRVpN8UBBMDhTuz91COZ/4QC4KhMo1QqSscCHqTJjw0Zk1MEHKGRxq2oJGmLWLUNe/5R0XZ8VeAIgcSnUVkylI8MCYPdJe1mAof98xBVyGilyvx7RDVjncBh88xUskGT5skrZ7eWFA0uBg5bJ6yLIg4aJavMSZYVPeQADjunHmUkRvWylVI6CjjsnO4sHDXFdYs7KFY9Bxz2TSzLBk2p5lnn6Klc1S4BOGybp5k4aH3PultYVcOBw7Z5kI3jEY+yuBRWVVIccNg0VZLYODp61A1gl40ADpsmj3IS7yqL4VTdEQ4c9kw2D0dDV9lAXlkD4LBnonmtPs31MzaJV/Yn4LBnhvJafUJl1TO8KpoOHPZMFq/VoyurunJxJBYBhy3Tl9fqlb9DFlN+CoDDlunPa/SbK4pmq+CYBxy2zEAtp5VsFRxNgcOWGcZr9Fsrip5UwbEI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"></p><p> 去掉base64编码中的前缀 <code>data:image/png;base64,</code></p> <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> baseStr=<span class="built_in">document</span>.getElementById(<span class="string">"imgcase"</span>).getAttribute(<span class="string">"src"</span>),tag=<span class="string">"base64,"</span>;</span><br><span class="line">baseStr=baseStr.substring(baseStr.indexOf(tag)+tag.length);</span><br></pre></td></tr></table></figure><p> 去掉base64编码中的<code>=</code>号</p> <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> eqTagIndex=baseStr.indexOf(<span class="string">"="</span>);</span><br><span class="line">baseStr=eqTagIndex!=<span class="number">-1</span>?baseStr.substring(<span class="number">0</span>,eqTagIndex):baseStr;</span><br></pre></td></tr></table></figure><p> 计算文件流大小</p> <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> strLen=baseStr.length;</span><br><span class="line"><span class="keyword">var</span> fileSize=strLen-(strLen/<span class="number">8</span>)*<span class="number">2</span></span><br><span class="line">alert(<span class="string">"文件大小:"</span>+fileSize);</span><br></pre></td></tr></table></figure><p>完整代码：<a href="https://demohubs.github.io/frontendLab/baseimgfileSize.html" target="_blank" rel="noopener">https://demohubs.github.io/frontendLab/baseimgfileSize.html</a>  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;有时候图片被&lt;code&gt;base64&lt;/code&gt;之后需要计算图片大小，因为被编码后全是字符，计算文件大小可以反序列化成文件之后再获取大小，但是会比较麻烦。简单介绍一种利用&lt;code&gt;base64&lt;/code&gt;编码原理计算大小的方法。&lt;/p&gt;
&lt;h4 id=&quot;编码原理&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="base64" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/base64/"/>
    
    
      <category term="base64" scheme="http://blog.seoui.com/tags/base64/"/>
    
  </entry>
  
  <entry>
    <title>JVM远程调试功能</title>
    <link href="http://blog.seoui.com/2018/04/18/jvmremote-debug/"/>
    <id>http://blog.seoui.com/2018/04/18/jvmremote-debug/</id>
    <published>2018-04-17T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.867Z</updated>
    
    <content type="html"><![CDATA[<p>有时候想调试线上的程序 可以启用远程调试功能 在本地调试远程代码。</p><h4 id="远程JVM启用调试模式"><a href="#远程JVM启用调试模式" class="headerlink" title="远程JVM启用调试模式"></a>远程JVM启用调试模式</h4> <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">/usr/<span class="keyword">local</span>/jdk/bin/java -server -Xms256m -Xmx256m -XX:PermSize=<span class="number">64</span>m -XX:MaxPermSize=<span class="number">128</span>m -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=<span class="number">1506</span> -jar /home/web/api<span class="number">-1.0</span>-SNAPSHOT/lib/api<span class="number">-1.0</span>-SNAPSHOT.jar <span class="comment">--spring.config.location=file:/home/web/api-1.0-SNAPSHOT/conf/</span></span><br></pre></td></tr></table></figure><p><code>-XDebug</code> 表示虚拟机启用调试功能<br><code>-Xrunjdwp</code> 加载JDWP<br><code>transport</code>  调试程序JVM使用的进程之间通讯方式<br><code>dt_socket</code> socket通讯<br><code>server=y/n</code> JVM是否需要作为调试服务器执行<br><code>address</code> 调试服务器监听的端口号<br><code>suspend=y/n</code> 调试客户端建立连接之后启动虚拟机</p><p>JVM启动之后用验证监听的端口号是否生效了 <code>netstat -anp | grep 1506</code></p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:1506                0.0.0.0:*                   LISTEN      4841/java</span><br></pre></td></tr></table></figure><h4 id="本地调试配置"><a href="#本地调试配置" class="headerlink" title="本地调试配置"></a>本地调试配置</h4><p><img src="http://static.1.seoui.com/images/2018/04/18/jvmremote-debug.png" alt=""></p><p>然后<code>debug</code>启动 访问远程服务器某个服务 在本地就支持打断点调试了。   </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;有时候想调试线上的程序 可以启用远程调试功能 在本地调试远程代码。&lt;/p&gt;
&lt;h4 id=&quot;远程JVM启用调试模式&quot;&gt;&lt;a href=&quot;#远程JVM启用调试模式&quot; class=&quot;headerlink&quot; title=&quot;远程JVM启用调试模式&quot;&gt;&lt;/a&gt;远程JVM启用调试模式&lt;
      
    
    </summary>
    
      <category term="技术" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="java" scheme="http://blog.seoui.com/categories/%E6%8A%80%E6%9C%AF/java/"/>
    
    
      <category term="jvm" scheme="http://blog.seoui.com/tags/jvm/"/>
    
      <category term="远程调试" scheme="http://blog.seoui.com/tags/%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Lua在Redis中的应用</title>
    <link href="http://blog.seoui.com/2018/01/27/redis-lua/"/>
    <id>http://blog.seoui.com/2018/01/27/redis-lua/</id>
    <published>2018-01-26T16:00:00.000Z</published>
    <updated>2018-09-06T06:21:47.864Z</updated>
    
    <content type="html"><![CDATA[<p><code>redis</code>从2.6版本开始内置支持<code>Lua</code>解释器，解释器提供了3个函数来处理<code>redis</code>的命令<code>redis.call()</code> <code>redis.pcall()</code>和 <code>redis.log</code>,同时<code>redis</code> 也保证脚本会以原子性的方式执行。这是一个很重要的因素。</p><p>本文涉及到的命令有 <code>EVAL</code>  <code>EVALSHA</code> <code>SCRIPT LOAD</code> <code>SCRIPT FLUSH</code> <code>SCRIPT EXISTS</code> <code>SCRIPT KILL</code></p><p><em>redis.call()， redis.pcall() 函数的区别就是处理错误异常的情况不同，其他的功能是一样的 具体使用哪个看需求而论</em></p><ul><li><code>redis.call()</code>  执行命令的过程中发生错误时，脚本会停止执行，并返回一个脚本错误</li><li><code>redis.pcall()</code> 执行命令的过程中发生错误时，脚本会继续执行，但是会记录错误信息 返回一个带 err 域的 Lua 表(table)</li><li><code>redis.log(loglevel, message)</code> 触发<code>redis</code>记录日志 日志级别有 redis.LOG_DEBUG redis.LOG_VERBOSE redis.LOG_NOTICE redis.LOG_WARNING</li></ul><h4 id="EVAL"><a href="#EVAL" class="headerlink" title="EVAL"></a>EVAL</h4><p><code>EVAL</code>命令对 <code>Lua</code> 脚本进行执行求值。</p><p> 语法：EVAL script numkeys key [key …] arg [arg …]</p><p> <code>script</code> lua脚本内容 注意的是脚本不应该是<code>Lua</code>函数。<br> <code>numkeys</code> 表示指定键名参数的个数。<br> <code>key [key ...]</code> 表示脚本对应的<code>key</code>值列表 在脚本中可以使用<em><code>KEYS[1]</code> <code>KEYS[2]</code> <code>KEYS[3]</code> <code>KEYS[n]</code></em> n从1开始 。<br> <code>arg [arg ...]</code> 命名行中传递的参数列表 在脚本中可以使用<em><code>ARGV[1]</code> <code>ARGV[2]</code> <code>ARGV[3]</code> <code>ARGV[n]</code></em> n从1开始 。</p><p> 一个示例胜过千言万语的解释</p> <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">eval <span class="string">"return &#123;KEYS[1],KEYS[2],ARGV[1],ARGV[2]&#125;"</span> <span class="number">2</span> id name <span class="number">3</span> mytest</span><br></pre></td></tr></table></figure><p>执行上面脚本返回</p> <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>) <span class="string">"id"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"name"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"mytest"</span></span><br></pre></td></tr></table></figure><h4 id="EVALSHA"><a href="#EVALSHA" class="headerlink" title="EVALSHA"></a>EVALSHA</h4><p>  此命令和<code>EVAL</code>的区别是<code>EVAL</code>每次都需要传入脚本的主体内容，对网络带宽不是很友好。而<code>EVALSHA</code>命令正好可以解决这个问题。</p><p>  语法： EVALSHA sha1 numkeys key [key …] arg [arg …]</p><p>  <code>sha1</code> 缓存中的<code>sha</code>值 这个值可以利用<code>SCRIPT LOAD</code>生成<br>  <code>numkeys</code> 表示指定键名参数的个数。<br>  <code>key [key ...]</code> 表示脚本对应的<code>key</code>值列表 在脚本中可以使用<em><code>KEYS[1]</code> <code>KEYS[2]</code> <code>KEYS[3]</code> <code>KEYS[n]</code></em> n从1开始 。<br>  <code>arg [arg ...]</code> 命名行中传递的参数列表 在脚本中可以使用<em><code>ARGV[1]</code> <code>ARGV[2]</code> <code>ARGV[3]</code> <code>ARGV[n]</code></em> n从1开始 。</p> <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt; SCRIPT LOAD <span class="string">"return &#123;KEYS[1],KEYS[2],ARGV[1],ARGV[2]&#125;"</span></span><br><span class="line"><span class="string">"a42059b356c875f0717db19a51f6aaca9ae659ea"</span></span><br><span class="line">&gt; EVALSHA a42059b356c875f0717db19a51f6aaca9ae659ea <span class="number">2</span> id name <span class="number">2</span> mytest</span><br><span class="line"><span class="number">1</span>) <span class="string">"id"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"name"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"2"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"mytest"</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>1、首先利用<code>SCRIPT LOAD</code>把脚本的主体缓存在<code>redis</code>中,会返回一个sha的key<br>2、<code>EVALSHA</code> 执行命令 把sha带上 其他的和eval没有区别。</p><h4 id="脚本缓存"><a href="#脚本缓存" class="headerlink" title="脚本缓存"></a>脚本缓存</h4><p>  <code>redis</code>保证了所有运行过的脚本都能缓存起来 前面也提到过使用<code>SCRIPT LOAD</code>也能将脚本缓存并返回sha值，那么也能使用<code>SCRIPT FLUSH</code>清空脚本缓存</p><ul><li><code>SCRIPT LOAD</code> 加载脚本到缓存中</li><li><code>SCRIPT FLUSH</code> 清除所有 Lua 脚本缓存。</li><li><code>SCRIPT EXISTS</code> 判断sha值是否已经缓存好了，返回值为  0 和 1 ，后者表示存在于缓存中，在程序开发中非常有用 比如 <code>redis</code>出现了什么异常情况后，脚本缓存被清空了，或者被人为执行了<code>SCRIPT FLUSH</code>命令，这个时候就可以优先尝试一下<code>SCRIPT EXISTS</code>命令如果返回0表示不存在 就需要先执行<code>SCRIPT LOAD</code>先把脚本加载到缓存中之后再执行</li></ul><h4 id="SCRIPT-KILL"><a href="#SCRIPT-KILL" class="headerlink" title="SCRIPT KILL"></a>SCRIPT KILL</h4><p> 杀死当前正在运行的 <code>Lua</code> 脚本，<code>当且仅当这个脚本没有执行过任何写操作时，这个命令才生效</code>。</p><p> <code>SCRIPT KILL</code> 执行成功返回OK，其他情况返回错误信息</p><h4 id="业务场景案例"><a href="#业务场景案例" class="headerlink" title="业务场景案例"></a>业务场景案例</h4><ul><li><a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/rate-limiter-no-lua" target="_blank" rel="noopener">spring-cloud-gateway</a>  springc cloud 网关限流</li><li>需要原子操作的零散逻辑</li><li>分布式限流</li><li>….</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;redis&lt;/code&gt;从2.6版本开始内置支持&lt;code&gt;Lua&lt;/code&gt;解释器，解释器提供了3个函数来处理&lt;code&gt;redis&lt;/code&gt;的命令&lt;code&gt;redis.call()&lt;/code&gt; &lt;code&gt;redis.pcall()&lt;/code&gt;和
      
    
    </summary>
    
      <category term="redis" scheme="http://blog.seoui.com/categories/redis/"/>
    
      <category term="lua" scheme="http://blog.seoui.com/categories/redis/lua/"/>
    
    
      <category term="redis" scheme="http://blog.seoui.com/tags/redis/"/>
    
      <category term="lua" scheme="http://blog.seoui.com/tags/lua/"/>
    
  </entry>
  
</feed>
